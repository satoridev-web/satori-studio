!function(e){FLBuilder={preview:null,_actionsLightbox:null,_ajaxQueue:[],_ajaxRequest:null,_colResizeData:null,_colResizing:!1,_contentClass:!1,_dragEnabled:!1,_dragging:!1,_dragInitialScrollTop:0,_exitUrl:null,_layout:null,_layoutQueue:[],_layoutSettingsCSSCache:null,_layoutSettingsCSSTimeout:null,_lightbox:null,_lightboxScrollbarTimeout:null,_loadedModuleAssets:[],_moduleHelpers:{},_multiplePhotoSelector:null,_newColParent:null,_newColPosition:0,_newColGroupParent:null,_newColGroupPosition:0,_newModuleParent:null,_newModulePosition:0,_newRowPosition:0,_selectedTemplateId:null,_selectedTemplateType:null,_singlePhotoSelector:null,_singleVideoSelector:null,_multipleAudiosSelector:null,_codeDisabled:!1,_sandbox:{},_publishAndRemain:!1,_shapesEdited:!1,_fontFamilyCache:null,_init:function(){FL.Builder.utils.isBlockEditor()||(FLBuilder.UIIFrame.init(),FLBuilder._initJQueryReadyFix(),FLBuilder._initGlobalErrorHandling(),FLBuilder._initPostLock(),FLBuilder._initClassNames(),FLBuilder._initMediaUploader(),FLBuilder._initOverflowFix(),FLBuilder._initScrollbars(),FLBuilder._initLightboxes(),FLBuilder._initDropTargets(),FLBuilder._initSortables(),FLBuilder._initStrings(),FLBuilder._initSanityChecks(),FLBuilder._initTipTips(),FLBuilder._initTinyMCE(),FLBuilder._bindEvents(),FLBuilder._bindOverlayEvents(),FLBuilder._setupEmptyLayout(),FLBuilder._highlightEmptyCols(),FLBuilder._checkEnv(),FL.Builder.utils.colorScheme.init(),FLBuilder.addHook("didInitUI",FLBuilder._showTourOrTemplates.bind(FLBuilder)),FLBuilder.addHook("endEditingSession",FLBuilder._doStats.bind(this)),FLBuilder.triggerHook("init"))},_initJQueryReadyFix:function(){FLBuilderConfig.debug||(jQuery.fn.oldReady=jQuery.fn.ready,jQuery.fn.ready=function(t){return jQuery.fn.oldReady(function(){try{"function"==typeof t&&t(e)}catch(e){FLBuilder.logError(e)}})})},_initSanityChecks:function(){FLBuilderConfig.uploadPath&&"undefined"==typeof FLBuilderLayout&&(url='<a href="'+FLBuilderConfig.uploadUrl+'">wp-admin -> Settings -> Media</a>',FLBuilder.alert('<strong>Critcal Error</strong><p style="font-size:15px;">Please go to '+url+" and make sure uploads folder settings is blank</p>"),e(".fl-builder-alert-close",window.parent.document).hide())},_initGlobalErrorHandling:function(){FLBuilderConfig.debug||(window.onerror=function(e,t,l,i,o){return FLBuilder.logGlobalError(e,t,l,i,o),!0})},_initPostLock:function(){void 0!==wp.heartbeat&&(wp.heartbeat.interval(120),wp.heartbeat.enqueue("fl_builder_post_lock",{post_id:FLBuilderConfig.postId}))},_heartbeatError:function(t,l){void 0!==l["wp-auth-check"]&&(l["wp-auth-check"]||(FLLightbox.closeAll(),FLBuilder.alert("You have been logged out. Please login to continue.<br />You will be redirected back here automatically.</p><p><button onclick=\"window.open('"+FLBuilderConfig.loginUrl+'\')" class="fl-builder-button fl-builder-button-large fl-builder-button-primary">Click to login</button></p>'),e(".fl-lightbox-footer").remove()))},_initClassNames:function(){var t=e("html").add("html",window.parent.document),l=e("body").add("body",window.parent.document);t.addClass("fl-builder-edit"),l.addClass("fl-builder"),FLBuilderConfig.simpleUi&&l.addClass("fl-builder-simple"),FLBuilder._contentClass=".fl-builder-content-"+FLBuilderConfig.postId,e(FLBuilder._contentClass).addClass("fl-builder-content-editing")},_initMediaUploader:function(){wp.media.model.settings.post.id=FLBuilderConfig.postId},_initOverflowFix:function(){e(FLBuilder._contentClass).parents().css("overflow","visible")},_initScrollbars:function(){var t=e(".fl-nanoscroller",window.parent.document).nanoScroller({documentContext:window.parent.document,alwaysVisible:!1,paneClass:"fl-nanoscroller-pane",sliderClass:"fl-nanoscroller-slider",contentClass:"fl-nanoscroller-content"}).filter(".fl-builder-settings-fields"),l=t.find(".fl-nanoscroller-pane");if(l.length){var i=l.get(0).style.display,o=t.find(".fl-nanoscroller-content");"none"===i?o.removeClass("has-scrollbar"):o.addClass("has-scrollbar")}},_initSortables:function(){var t={frame:null,appendTo:FLBuilder._contentClass,scroll:!0,cursor:"move",cursorAt:{left:85,top:20},distance:1,helper:FLBuilder._blockDragHelper,start:FLBuilder._blockDragStart,sort:FLBuilder._blockDragSort,change:FLBuilder._blockDragChange,stop:FLBuilder._blockDragStop,placeholder:"fl-builder-drop-zone",tolerance:"intersect"},l="",i="",o="";FLBuilder.UIIFrame.isEnabled()&&(t.frame=e("#fl-builder-ui-iframe",window.parent.document),t.appendTo=e("body",window.parent.document),t.scroll=!1),e(FLBuilder._contentClass+" [data-children-wrapper]").each(function(){e(this).closest(".fl-module").attr("data-has-children-wrapper","true")}),o="row"==FLBuilderConfig.userTemplateType?FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-content, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-module[data-accepts]:not([data-has-children-wrapper]):not(:has(> .fl-module-content)), "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-module[data-accepts]:not([data-has-children-wrapper]) > .fl-module-content, "+FLBuilder._contentClass+" [data-children-wrapper]":"column"==FLBuilderConfig.userTemplateType?FLBuilder._contentClass+" .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-col-drop-target, "+FLBuilder._contentClass+" .fl-col-content, "+FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]):not(:has(> .fl-module-content)), "+FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]) > .fl-module-content, "+FLBuilder._contentClass+" [data-children-wrapper]":"module"==FLBuilderConfig.userTemplateType?FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]):not(:has(> .fl-module-content)), "+FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]) > .fl-module-content, "+FLBuilder._contentClass+" [data-children-wrapper]":FLBuilder._contentClass+" .fl-row-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col:not(.fl-builder-node-loading):not(.fl-node-global) .fl-col-content, "+FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]):not(:has(> .fl-module-content)):not(.fl-node-global), "+FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]):not(.fl-node-global) > .fl-module-content, "+FLBuilder._contentClass+" :not(.fl-node-global) [data-children-wrapper]",i="row"==FLBuilderConfig.userTemplateType?FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-drop-target":FLBuilder._contentClass+" .fl-row-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-drop-target",l=FLBuilderConfig.nestedColumns?o:"row"==FLBuilderConfig.userTemplateType?FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-drop-target":FLBuilder._contentClass+" .fl-row-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-group-drop-target, "+FLBuilder._contentClass+" .fl-row:not(.fl-builder-node-loading) .fl-col-drop-target",e(".fl-builder-rows",window.parent.document).sortable(e.extend({},t,{connectWith:l,items:".fl-builder-block-row",stop:FLBuilder._rowDragStop})),e(".fl-builder-row-templates",window.parent.document).sortable(e.extend({},t,{connectWith:FLBuilder._contentClass+" .fl-row-drop-target",items:".fl-builder-block-row-template:not(.fl-builder-block-disabled)",stop:FLBuilder._nodeTemplateDragStop})),e(".fl-builder-saved-rows",window.parent.document).sortable(e.extend({},t,{cancel:".fl-builder-node-template-actions, .fl-builder-node-template-edit, .fl-builder-node-template-delete",connectWith:FLBuilder._contentClass+" .fl-row-drop-target",items:".fl-builder-block-saved-row",stop:FLBuilder._nodeTemplateDragStop})),e(".fl-builder-saved-columns",window.parent.document).sortable(e.extend({},t,{cancel:".fl-builder-node-template-actions, .fl-builder-node-template-edit, .fl-builder-node-template-delete",connectWith:i,items:".fl-builder-block-saved-column",stop:FLBuilder._nodeTemplateDragStop})),e(".fl-builder-modules, .fl-builder-widgets",window.parent.document).sortable(e.extend({},t,{connectWith:o,items:".fl-builder-block-module:not(.fl-builder-block-disabled)",stop:FLBuilder._moduleDragStop})),e(".fl-builder-module-templates",window.parent.document).sortable(e.extend({},t,{connectWith:o,items:".fl-builder-block-module-template",stop:FLBuilder._nodeTemplateDragStop})),e(".fl-builder-saved-modules",window.parent.document).sortable(e.extend({},t,{cancel:".fl-builder-node-template-actions, .fl-builder-node-template-edit, .fl-builder-node-template-delete",connectWith:o,items:".fl-builder-block-saved-module",stop:FLBuilder._nodeTemplateDragStop})),e(".fl-row-sortable-proxy",window.parent.document).sortable(e.extend({},t,{connectWith:FLBuilder._contentClass+" .fl-row-drop-target",helper:FLBuilder._rowDragHelper,start:FLBuilder._rowDragStart,stop:FLBuilder._rowDragStop})),e(".fl-col-sortable-proxy",window.parent.document).sortable(e.extend({},t,{connectWith:o,helper:FLBuilder._colDragHelper,start:FLBuilder._colDragStart,stop:FLBuilder._colDragStop})),e(".fl-module-sortable-proxy",window.parent.document).sortable(e.extend({},t,{connectWith:o,helper:FLBuilder._moduleDragHelper,start:FLBuilder._moduleDragStart,stop:FLBuilder._moduleDragStop})),e(FLBuilder._contentClass+" .fl-col-content").sortable(e.extend({},t,{cancel:".fl-module, .fl-col-group",handle:".fl-module-sortable-proxy"})),e(FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]):not(:has(> .fl-module-content))").sortable(e.extend({},t,{cancel:".fl-module",handle:".fl-module-sortable-proxy"})),e(FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper]) > .fl-module-content").sortable(e.extend({},t,{cancel:".fl-module",handle:".fl-module-sortable-proxy"})),e(FLBuilder._contentClass+" [data-children-wrapper]").sortable(e.extend({},t,{cancel:".fl-module",handle:".fl-module-sortable-proxy"})),e(FLBuilder._contentClass+" .fl-row-drop-target").sortable(t),e(FLBuilder._contentClass+" .fl-col-group-drop-target").sortable(t),e(FLBuilder._contentClass+" .fl-col-drop-target").sortable(t)},_refreshSortables:function(){var t=e(".ui-sortable").add(".ui-sortable",window.parent.document);t.sortable("refresh"),t.sortable("refreshPositions")},_initStrings:function(){e.validator.messages.required=FLBuilderStrings.validateRequiredMessage},_bindEvents:function(){if(!e("body").hasClass("wp-admin")){var t=e(".fl-builder-bar a, .fl-builder--content-library-panel a, .fl-page-nav .nav a");e("a").not(t).on("click",FLBuilder._preventDefault),e(".fl-page-nav .nav a").on("click",FLBuilder._headerLinkClicked),e("body").on("click",".fl-builder-content a",FLBuilder._preventDefault),e("body").on("mouseup","button.fl-builder-button",this._buttonMouseUp.bind(this))}e(document).on("heartbeat-tick",FLBuilder._initPostLock),e(document).on("heartbeat-tick",FLBuilder._heartbeatError),e(window.parent).on("beforeunload",FLBuilder._warnBeforeUnload),e("body",window.parent.document).on("click",".fl-builder-blocks-pro-expand",FLBuilder._toggleProModules),e("body",window.parent.document).on("click",".fl-builder-upgrade-button",FLBuilder._upgradeClicked),e(".fl-builder-panel-actions .fl-builder-panel-close",window.parent.document).on("click",FLBuilder._closePanel),e("body",window.parent.document).on("mousedown",".fl-builder-node-template-actions",FLBuilder._stopPropagation),e("body",window.parent.document).on("mousedown",".fl-builder-node-template-edit",FLBuilder._stopPropagation),e("body",window.parent.document).on("mousedown",".fl-builder-node-template-delete",FLBuilder._stopPropagation),e("body",window.parent.document).on("click",".fl-builder-node-template-edit",FLBuilder._editNodeTemplateClicked),e("body",window.parent.document).on("click",".fl-builder-node-template-delete",FLBuilder._deleteNodeTemplateClicked),e("body",window.parent.document).on("mousedown",".fl-builder-block:not(.fl-builder-block-disabled)",FLBuilder._blockDragInit),e("body",window.parent.document).on("mouseup",FLBuilder._blockDragCancel),e("body",window.parent.document).on("click",".fl-builder-actions .fl-builder-cancel-button",FLBuilder._cancelButtonClicked),e("body",window.parent.document).on("click",".fl-builder-layout-settings .fl-builder-settings-save",FLBuilder._saveLayoutSettingsClicked),e("body",window.parent.document).on("click",".fl-builder-layout-settings .fl-builder-settings-cancel",FLBuilder._cancelLayoutSettingsClicked),e("body",window.parent.document).on("click",".fl-builder-global-settings .fl-builder-settings-save",FLBuilder._saveGlobalSettingsClicked),e("body",window.parent.document).on("click",".fl-builder-global-settings .fl-builder-settings-cancel",FLBuilder._cancelLayoutSettingsClicked),e("body",window.parent.document).on("click",".fl-user-template",FLBuilder._userTemplateClicked),e("body",window.parent.document).on("click",".fl-user-template-edit",FLBuilder._editUserTemplateClicked),e("body",window.parent.document).on("click",".fl-user-template-delete",FLBuilder._deleteUserTemplateClicked),e("body",window.parent.document).on("click",".fl-builder-template-replace-button",FLBuilder._templateReplaceClicked),e("body",window.parent.document).on("click",".fl-builder-template-append-button",FLBuilder._templateAppendClicked),e("body",window.parent.document).on("click",".fl-builder-template-actions .fl-builder-cancel-button",FLBuilder._templateCancelClicked),e("body",window.parent.document).on("click",".fl-builder-user-template-settings .fl-builder-settings-save",FLBuilder._saveUserTemplateSettings),e("body",window.parent.document).on("click",".fl-builder-no-tour-button",FLBuilder._noTourButtonClicked),e("body",window.parent.document).on("click",".fl-builder-yes-tour-button",FLBuilder._yesTourButtonClicked),e("body",window.parent.document).on("click",".fl-builder-alert-close",FLBuilder._alertClose),e("body",window.parent.document).on("click",".fl-builder-settings-save-as",FLBuilder._showNodeTemplateSettings),e("body",window.parent.document).on("click",".fl-builder-node-template-settings .fl-builder-settings-save",FLBuilder._saveNodeTemplate),e("body",window.parent.document).on("click",".fl-builder-settings-tabs a",FLBuilder._settingsTabClicked),e("body",window.parent.document).on("show",".fl-builder-settings-tabs a",FLBuilder._calculateSettingsTabsOverflow),e("body",window.parent.document).on("hide",".fl-builder-settings-tabs a",FLBuilder._calculateSettingsTabsOverflow),e("body",window.parent.document).on("click",".fl-builder-settings-cancel",FLBuilder._settingsCancelClicked),e("body",window.parent.document).on("click",".fl-builder-settings-tabs-overflow-menu > a",FLBuilder._settingsTabsToOverflowMenuItemClicked.bind(this)),e("body",window.parent.document).on("click",".fl-builder-settings-tabs-more",FLBuilder._toggleTabsOverflowMenu.bind(this)),e("body",window.parent.document).on("click",".fl-builder-settings-tabs-overflow-click-mask",FLBuilder._hideTabsOverflowMenu.bind(this)),e("body",window.parent.document).on("mouseover",".fl-help-tooltip-icon",FLBuilder._showHelpTooltip),e("body",window.parent.document).on("mouseout",".fl-help-tooltip-icon",FLBuilder._hideHelpTooltip),e("body",window.parent.document).on("click",".fl-builder-field-add",FLBuilder._addFieldClicked),e("body",window.parent.document).on("click",".fl-builder-field-copy",FLBuilder._copyFieldClicked),e("body",window.parent.document).on("click",".fl-builder-field-delete",FLBuilder._deleteFieldClicked),e("body",window.parent.document).on("click",".fl-photo-field .fl-photo-select",FLBuilder._selectSinglePhoto),e("body",window.parent.document).on("click",".fl-photo-field .fl-photo-edit",FLBuilder._selectSinglePhoto),e("body",window.parent.document).on("click",".fl-photo-field .fl-photo-replace",FLBuilder._selectSinglePhoto),e("body",window.parent.document).on("click",".fl-photo-field .fl-photo-remove",FLBuilder._singlePhotoRemoved),e("body",window.parent.document).on("click",".fl-multiple-photos-field .fl-multiple-photos-select",FLBuilder._selectMultiplePhotos),e("body",window.parent.document).on("click",".fl-multiple-photos-field .fl-multiple-photos-edit",FLBuilder._selectMultiplePhotos),e("body",window.parent.document).on("click",".fl-multiple-photos-field .fl-multiple-photos-add",FLBuilder._selectMultiplePhotos),e("body",window.parent.document).on("click",".fl-video-field .fl-video-select",FLBuilder._selectSingleVideo),e("body",window.parent.document).on("click",".fl-video-field .fl-video-replace",FLBuilder._selectSingleVideo),e("body",window.parent.document).on("click",".fl-video-field .fl-video-remove",FLBuilder._singleVideoRemoved),e("body",window.parent.document).on("click",".fl-multiple-audios-field .fl-multiple-audios-select",FLBuilder._selectMultipleAudios),e("body",window.parent.document).on("click",".fl-multiple-audios-field .fl-multiple-audios-edit",FLBuilder._selectMultipleAudios),e("body",window.parent.document).on("click",".fl-multiple-audios-field .fl-multiple-audios-add",FLBuilder._selectMultipleAudios),e("body",window.parent.document).on("click",".fl-icon-field .fl-icon-select",FLBuilder._selectIcon),e("body",window.parent.document).on("click",".fl-icon-field .fl-icon-replace",FLBuilder._selectIcon),e("body",window.parent.document).on("click",".fl-icon-field .fl-icon-remove",FLBuilder._removeIcon),e("body",window.parent.document).on("click",".fl-form-field .fl-form-field-edit",FLBuilder._formFieldClicked),e("body",window.parent.document).on("click",".fl-form-field-settings .fl-builder-settings-save",FLBuilder._saveFormFieldClicked),e("body",window.parent.document).on("click",".fl-layout-field-option",FLBuilder._layoutFieldClicked),e("body",window.parent.document).on("click",".fl-link-field-select",FLBuilder._linkFieldSelectClicked),e("body",window.parent.document).on("click",".fl-link-field-search-cancel",FLBuilder._linkFieldSelectCancelClicked),e("body",window.parent.document).on("change",".fl-loop-data-source-select select[name=data_source]",FLBuilder._loopDataSourceChange),e("body",window.parent.document).on("change",".fl-custom-query select[name=post_type]",FLBuilder._customQueryPostTypeChange),e("body",window.parent.document).on("change",'.fl-custom-query select[name="post_type[]"]',FLBuilder._customQueryPostTypesChange),e("body",window.parent.document).on("change",".fl-text-field-add-value",FLBuilder._textFieldAddValueSelectChange),e("body",window.parent.document).on("focus",".fl-field input[type=number]",FLBuilder._onNumberFieldFocus),e("body",window.parent.document).on("blur",".fl-field input[type=number]",FLBuilder._onNumberFieldBlur),FLBuilder.addHook("didCompleteAJAX",FLBuilder._refreshSettingsPreviewReference),FLBuilder.addHook("didRenderLayoutComplete",FLBuilder._refreshSettingsPreviewReference)},_unbindEvents:function(){e("a").off("click",FLBuilder._preventDefault),e(".fl-page-nav .nav a").off("click",FLBuilder._headerLinkClicked),e("body").undelegate(".fl-builder-content a","click",FLBuilder._preventDefault)},_rebindEvents:function(){e("a").on("click",FLBuilder._preventDefault),e(".fl-page-nav .nav a").on("click",FLBuilder._headerLinkClicked),e("body").on("click",".fl-builder-content a",FLBuilder._preventDefault)},_preventDefault:function(e){e.preventDefault()},_stopPropagation:function(e){e.stopPropagation()},_headerLinkClicked:function(t){var l=e(this).attr("href");this.hash||(t.preventDefault(),FLBuilderConfig.isUserTemplate||(FLBuilder._exitUrl=l.indexOf("?")>-1?l:l+"?fl_builder",FLBuilder.triggerHook("triggerDone")))},_warnBeforeUnload:function(){var t=e(".fl-builder-row-settings",window.parent.document).length>0,l=e(".fl-builder-col-settings",window.parent.document).length>0,i=e(".fl-builder-module-settings",window.parent.document).length>0;if(!FLBuilder.isBlockEditor()&&(t||l||i))return FLBuilderStrings.unloadWarning},_upgradeClicked:function(){window.parent.open(FLBuilderConfig.upgradeUrl)},_toggleProModules:function(){var t=e(".fl-builder-blocks-pro-expand",window.parent.document),l=e(".fl-builder-blocks-pro-closed",window.parent.document),i=e(".fl-builder-blocks-pro-open",window.parent.document);t.toggleClass("fl-builder-blocks-pro-expand-rotate"),l.length?(l.removeClass("fl-builder-blocks-pro-closed"),l.addClass("fl-builder-blocks-pro-open")):(i.removeClass("fl-builder-blocks-pro-open"),i.addClass("fl-builder-blocks-pro-closed"))},_showProMessage:function(e){},_initTipTips:function(){var t=".fl-tip:not(.fl-has-tip)",l=e(t).add(t,window.parent.document);l.each(function(){var t=e(this);t.addClass("fl-has-tip"),null==t.attr("data-title")&&t.attr("data-title",t.attr("title"))}),FLBuilderLayout._isTouch()||l.tipTip({defaultPosition:"top",delay:300,maxWidth:"auto"})},_hideTipTips:function(){e("#tiptip_holder").stop().hide(),e("#tiptip_holder",window.parent.document).stop().hide()},_submenuParentClicked:function(t){var l=e("body"),i=e(this),o=i.find(".fl-builder-submenu");i.hasClass("fl-builder-submenu-open")?(l.removeClass("fl-builder-submenu-open"),i.removeClass("fl-builder-submenu-open"),i.removeClass("fl-builder-submenu-right")):(i.offset().left+o.width()>e(window).width()&&i.addClass("fl-builder-submenu-right"),l.addClass("fl-builder-submenu-open"),i.addClass("fl-builder-submenu-open")),o.closest(".fl-row-overlay").addClass("fl-row-menu-active"),FLBuilder._hideTipTips(),t.preventDefault(),t.stopPropagation()},_hoverMenuParentMouseEnter:function(t){t.stopPropagation();var l=e("body"),i=e(this),o=i.find(".fl-builder-submenu");e(".fl-builder-submenu").each(function(){var t=e(this).data("timeout");void 0!==t&&clearTimeout(t)}),e(".fl-builder-submenu-right").removeClass("fl-builder-submenu-right"),e(".fl-builder-submenu-open").removeClass("fl-builder-submenu-open"),e(".fl-row-menu-active").removeClass("fl-row-menu-active"),i.offset().left+o.width()>e(window).width()&&i.addClass("fl-builder-submenu-right"),i.closest(".fl-row-overlay").addClass("fl-row-menu-active"),l.addClass("fl-builder-submenu-open"),i.addClass("fl-builder-submenu-open")},_hoverMenuParentMouseLeave:function(t){var l=e(this),i=l.find(".fl-builder-submenu"),o=setTimeout(function(){l.removeClass("fl-builder-submenu-right"),l.removeClass("fl-builder-submenu-open"),l.closest(".fl-row-overlay").removeClass("fl-row-menu-active")},500);i.data("timeout",o)},_submenuChildClicked:function(t){var l=e("body"),i=e(this).parents(".fl-builder-has-submenu");i.parents(".fl-builder-has-submenu").length||(l.removeClass("fl-builder-submenu-open"),i.removeClass("fl-builder-submenu-open"))},_submenuMouseenter:function(t){if(!e(this).parent().hasClass("fl-builder-submenu-hover")){var l=e(this).data("timeout");void 0!==l&&clearTimeout(l)}},_submenuMouseleave:function(t){if(!e(this).parent().hasClass("fl-builder-submenu-hover")){var l=e("body"),i=e(this),o=setTimeout(function(){l.removeClass("fl-builder-submenu-open"),i.closest(".fl-builder-has-submenu").removeClass("fl-builder-submenu-open")},500);i.closest(".fl-row-overlay").removeClass("fl-row-menu-active"),i.data("timeout",o)}},_submenuNestedParentMouseenter:function(t){var l=e(this),i=l.find("> .fl-builder-submenu"),o=e(window).width(),n=l.offset().left,d=o-(l.width()+n);if(l.width()+n+i.width()>o&&i.width()<n)l.addClass("fl-builder-submenu-right");else if(i.width()>d){var r=l.width()-(i.width()-d);i.css("left",r)}},_closeAllSubmenus:function(){e(".fl-builder-submenu-open").removeClass("fl-builder-submenu-open")},_buttonMouseUp:function(t){e(t.currentTarget).blur()},_closePanel:function(){FLBuilder.triggerHook("hideContentPanel")},_showPanel:function(){FLBuilder.triggerHook("showContentPanel")},_togglePanel:function(){FLBuilder.triggerHook("toggleContentPanel")},_publishLayout:function(e,t){if(!FLBuilder._triggerSettingsSave(t,!0))return;if(_.isUndefined(e))e=!0;const l=FL.Builder.data.getLayoutActions(),i=FLBuilder._onPublishComplete.bind(FLBuilder,e);l.saveLayout(!0,e,i)},_publishButtonClicked:function(e){FLBuilder._publishLayout(e)},_onPublishComplete:function(t){t&&(FLBuilderConfig.shouldRefreshOnPublish?FLBuilder._exit():FLBuilder._exitWithoutRefresh()),e("#wp-admin-bar-fl-builder-frontend-edit-link .fl-builder-admin-bar-status-dot").css("color","#6bc373"),FLBuilder.triggerHook("didPublishLayout",{shouldExit:t})},_draftButtonClicked:function(){FLBuilder.showAjaxLoader();FL.Builder.data.getLayoutActions().saveDraft()},_discardButtonClicked:function(){if(confirm(FLBuilderStrings.discardMessage)){FLBuilder.showAjaxLoader();FL.Builder.data.getLayoutActions().discardDraft()}else FLBuilder.triggerHook("didCancelDiscard")},_cancelButtonClicked:function(){FLBuilder._exitUrl=null,FLBuilder._actionsLightbox.close()},_exit:function(){var t=window.parent.location.href;try{var l=void 0!==window.parent.opener.FLBuilder}catch(e){l=!1}if(FLBuilderConfig.isUserTemplate&&void 0!==window.parent.opener&&window.parent.opener)l&&("undefined"==typeof FLBuilderGlobalNodeId?window.parent.opener.FLBuilder._updateLayout():window.parent.opener.FLBuilder._updateNode(FLBuilderGlobalNodeId)),window.parent.close();else if(t=FLBuilder._exitUrl?FLBuilder._exitUrl:(t=(t=(t=t.replace("&fl_builder_ui","")).replace("?fl_builder&","?")).replace("?fl_builder","")).replace("&fl_builder",""),"playground.wordpress.net"===window.parent.location.host){const l='<meta http-equiv="refresh" content="0; URL=\''+t+"'\" />";e("head",window.parent.document).append(l)}else window.parent.location.href=t},_exitWithoutRefresh:function(){window.parent.location.href;try{var e=void 0!==window.parent.opener.FLBuilder}catch(t){e=!1}FLBuilderConfig.isUserTemplate&&e&&window.opener?(e&&("undefined"==typeof FLBuilderGlobalNodeId?window.parent.opener.FLBuilder._updateLayout():window.parent.opener.FLBuilder._updateNode(FLBuilderGlobalNodeId)),window.parent.close()):FLBuilder.triggerHook("endEditingSession")},_duplicateLayoutClicked:function(){FLBuilder.showAjaxLoader(),FLBuilder.ajax({action:"duplicate_post"},FLBuilder._duplicateLayoutComplete)},_duplicateLayoutComplete:function(e){var t=FLBuilderConfig.adminUrl;window.parent.location.href=t+"post.php?post="+e+"&action=edit"},_layoutSettingsClicked:function(){FLBuilderSettingsForms.render({id:"layout",className:"fl-builder-layout-settings",settings:FLBuilderSettingsConfig.settings.layout},function(){FLBuilder._layoutSettingsInitCSS()})},_layoutSettingsInitCSS:function(){var t=e(".fl-builder-settings #fl-field-css textarea:not(.ace_text-input)",window.parent.document);t.on("change",FLBuilder._layoutSettingsCSSChanged),FLBuilder._layoutSettingsCSSCache=t.val()},_layoutSettingsCSSChanged:function(){FLBuilder._layoutSettingsCSSTimeout&&clearTimeout(FLBuilder._layoutSettingsCSSTimeout),FLBuilder._layoutSettingsCSSTimeout=setTimeout(e.proxy(FLBuilder._layoutSettingsCSSDoChange,this),600)},_layoutSettingsCSSDoChange:function(){var t=e(".fl-builder-settings",window.parent.document),l=e(this);l.parents("#fl-field-css").find(".ace_error").length>0||(t.hasClass("fl-builder-layout-settings")?e("#fl-builder-layout-css").html(l.val()):e("#fl-builder-global-css").html(l.val()),FLBuilder._layoutSettingsCSSTimeout=null)},_saveLayoutSettingsClicked:function(){for(var t=e(this).closest(".fl-builder-settings").serializeArray(),l={},i=0;i<t.length;i++)l[t[i].name]=t[i].value;FLBuilder.showAjaxLoader(),FLBuilder._lightbox.close(),FLBuilder._layoutSettingsCSSCache=null;FL.Builder.data.getLayoutActions().saveLayoutSettings(l)},_cancelLayoutSettingsClicked:function(){e(".fl-builder-settings",window.parent.document).hasClass("fl-builder-layout-settings")?e("#fl-builder-layout-css").html(FLBuilder._layoutSettingsCSSCache):e("#fl-builder-global-css").html(FLBuilder._layoutSettingsCSSCache),FLBuilder._layoutSettingsCSSCache=null},_saveLayoutSettingsComplete:function(e){FLBuilder.triggerHook("didSaveLayoutSettingsComplete",e),FLBuilder._updateLayout()},_globalSettingsClicked:function(){const e=FLBuilderSettingsConfig.settings.global;e.color_scheme=FL.Builder.data.getSystemState().colorScheme,FLBuilderSettingsForms.render({id:"global",className:"fl-builder-global-settings",settings:e},function(){FLBuilder._layoutSettingsInitCSS(),FLBuilder.original_shapes=FLBuilderSettingsConfig.settings.global.shape_form})},_saveGlobalSettingsClicked:function(){var t=e(this).closest(".fl-builder-settings"),l=t.validate().form(),i=FLBuilder._getSettings(t);if(l){FLBuilder.showAjaxLoader(),FLBuilder._layoutSettingsCSSCache=null;FL.Builder.data.getLayoutActions().saveGlobalSettings(i),FLBuilder._lightbox.close(),void 0!==FLBuilder.original_shapes&&FLBuilder.original_shapes.length!==i.shape_form?.length&&(FLBuilder._shapesEdited=!0)}},_saveGlobalSettingsComplete:function(e){FLBuilder.triggerHook("didSaveGlobalSettingsComplete",FLBuilder._jsonParse(e)),FLBuilder._updateLayout(),!0===FLBuilder._shapesEdited&&window.parent.location.reload(!0)},_globalStylesClicked:function(){FLBuilderConfig.lite?FLBuilder._showProMessage("Global Styles"):"undefined"!=typeof FLBuilderGlobalStyles&&FLBuilderGlobalStyles._showPanel()},_initTemplateSelector:function(){e(FLBuilder._contentClass).find(".fl-row").length>0||FLBuilder.ContentPanel.show("modules")},_requestTemplateInsert:function(e,t){FLBuilder.layoutHasContent()?0==e?confirm(FLBuilderStrings.changeTemplateMessage)&&(FLBuilder._lightbox._node.hide(),FLBuilder._applyTemplate(0,!1,t)):(FLBuilder._selectedTemplateId=e,FLBuilder._selectedTemplateType=t,FLBuilder._showTemplateActions(),FLBuilder._lightbox._node.hide()):FLBuilder._applyTemplate(e,!1,t)},_showTemplateActions:function(){var e=[];e[10]={key:"template-replace",label:FLBuilderStrings.templateReplace},e[20]={key:"template-append",label:FLBuilderStrings.templateAppend},FLBuilder._showActionsLightbox({className:"fl-builder-template-actions",title:FLBuilderStrings.actionsLightboxTitle,buttons:e})},_templateReplaceClicked:function(){confirm(FLBuilderStrings.changeTemplateMessage)&&(FLBuilder._actionsLightbox.close(),FLBuilder._applyTemplate(FLBuilder._selectedTemplateId,!1,FLBuilder._selectedTemplateType))},_templateAppendClicked:function(){FLBuilder._actionsLightbox.close(),FLBuilder._applyTemplate(FLBuilder._selectedTemplateId,!0,FLBuilder._selectedTemplateType)},_templateCancelClicked:function(){FLBuilder.triggerHook("showContentPanel")},_applyTemplate:function(e,t,l){t=void 0!==t&&t?"1":"0",l=void 0===l?"core":l,FLBuilder._lightbox.close(),FLBuilder.showAjaxLoader();FL.Builder.data.getLayoutActions().applyTemplate(e,t,l),FLBuilder.triggerHook("didApplyTemplate")},_applyTemplateComplete:function(e){var t=FLBuilder._jsonParse(e);FLBuilder._renderLayout(t.layout),FLBuilder.triggerHook("didApplyTemplateComplete",t.config)},_applyUserTemplateComplete:function(t){var l=FLBuilder._jsonParse(t);null!==l.layout_css&&e("#fl-builder-layout-css").html(l.layout_css),FLBuilder._renderLayout(l.layout),FLBuilder.triggerHook("didApplyTemplateComplete",l.config)},_saveUserTemplateClicked:function(){FLBuilderConfig.lite?FLBuilder._showProMessage("Saving Templates"):FLBuilderSettingsForms.render({id:"user_template",className:"fl-builder-user-template-settings",rules:{name:{required:!0}}})},_saveUserTemplateSettings:function(){var t=e(this).closest(".fl-builder-settings"),l=t.validate().form(),i=FLBuilder._getSettings(t);if(l){FL.Builder.data.getLayoutActions().saveUserTemplateSettings(i),FLBuilder._lightbox.close()}},_saveUserTemplateSettingsComplete:function(e){if(e){e=FLBuilder._jsonParse(e);FLBuilderConfig.contentItems.template.push(e),FLBuilder.triggerHook("contentItemsChanged")}},_userTemplateClicked:function(){var t=e(this).attr("data-id");e(FLBuilder._contentClass).children(".fl-row").length>0?"blank"==t?confirm(FLBuilderStrings.changeTemplateMessage)&&(FLBuilder._lightbox._node.hide(),FLBuilder._applyTemplate("blank",!1,"user")):(FLBuilder._selectedTemplateId=t,FLBuilder._selectedTemplateType="user",FLBuilder._showTemplateActions(),FLBuilder._lightbox._node.hide()):FLBuilder._applyTemplate(t,!1,"user")},_editUserTemplateClicked:function(t){t.preventDefault(),t.stopPropagation(),window.parent.open(e(this).attr("href"))},_deleteUserTemplateClicked:function(t){var l=e(this).closest(".fl-user-template").attr("data-id"),i=(e(".fl-user-template[data-id="+l+"]",window.parent.document),null),o=null;if(confirm(FLBuilderStrings.deleteTemplate)){const e=FL.Builder.data.getLayoutActions();for(o in e.deleteUserTemplate(l),FLBuilderConfig.contentItems.template)FLBuilderConfig.contentItems.template[o].postId==l&&(i=o);_.isNull(i)||(FLBuilderConfig.contentItems.template.splice(i,1),FLBuilder.triggerHook("contentItemsChanged"))}t.stopPropagation()},_showTourOrTemplates:function(){FLBuilderConfig.simpleUi||FLBuilderConfig.isUserTemplate||(FLBuilderConfig.help.tour&&FLBuilderConfig.newUser?FLBuilder._showTourLightbox():FLBuilder._initTemplateSelector())},_doStats:function(){1==FLBuilderConfig.statsEnabled&&(args={"screen-width":screen.width,"screen-height":screen.height,"pixel-ratio":window.devicePixelRatio,"user-agent":window.navigator.userAgent,isrtl:FLBuilderConfig.isRtl},FLBuilder.ajax({action:"save_browser_stats",browser_data:args}))},_showTourLightbox:function(){var e=wp.template("fl-tour-lightbox");FLBuilder._actionsLightbox.open(e())},_noTourButtonClicked:function(){FLBuilder._actionsLightbox.close(),FLBuilder._initTemplateSelector()},_yesTourButtonClicked:function(){FLBuilder._actionsLightbox.close(),FLBuilderTour.start()},_startHelpTour:function(){FLBuilder._actionsLightbox.close(),FLBuilderTour.start()},_setupEmptyLayout:function(){var t=e(FLBuilder._contentClass);FLBuilderConfig.isUserTemplate&&"module"==FLBuilderConfig.userTemplateType||FLBuilderConfig.isUserTemplate&&"column"==FLBuilderConfig.userTemplateType||(t.removeClass("fl-builder-empty"),t.find(".fl-builder-empty-message").remove(),t.find(".fl-row, .fl-module, .fl-builder-block").length||(t.addClass("fl-builder-empty"),t.append('<span class="fl-builder-empty-message">'+FLBuilderStrings.emptyMessage+"</span>"),FLBuilder._initSortables()))},_updateNode:function(t,l){if(!e(".fl-node-"+t).length)return;FLBuilder._showNodeLoading(t);FL.Builder.data.getLayoutActions().renderNode(t,l)},_updateLayout:function(){FLBuilder.showAjaxLoader();const e=FL.Builder.data.getLayoutActions();e.renderLayout(),e.fetchLayout()},_renderLayout:function(e,t){FLBuilder._layout?FLBuilder._layoutQueue.push({data:e,callback:t}):FLBuilder._layout=new FLBuilderAJAXLayout(e,t)},_renderLayoutComplete:function(){if(FLBuilder._layout&&(FLBuilder._layout._complete(),FLBuilder._layout=null),FLBuilder._layoutQueue.length){var e=FLBuilder._layoutQueue.shift();FLBuilder._layout=new FLBuilderAJAXLayout(e.data,e.callback)}},_resizeLayout:function(){e(window).trigger("resize"),"undefined"!=typeof YUI&&YUI().use("node-event-simulate",function(e){e.one(window).simulate("resize")})},layoutHasContent:function(){return e(FLBuilder._contentClass).children(".fl-row, .fl-module").length>0},_initMediaElements:function(){var t={};void 0!==e.fn.mediaelementplayer&&("undefined"!=typeof _wpmejsSettings&&(t.pluginPath=_wpmejsSettings.pluginPath),e(".wp-audio-shortcode, .wp-video-shortcode").not(".mejs-container").mediaelementplayer(t))},_initDropTargets:function(){var t="row"==FLBuilderConfig.userTemplateType?"":":not(.fl-node-global)",l=e(FLBuilder._contentClass+" .fl-row"),i=e(FLBuilder._contentClass+" .fl-row"+t).find(".fl-col-group"),o=null,n=null,d="column"==FLBuilderConfig.userTemplateType?e(FLBuilder._contentClass+"> .fl-col").eq(0):null,r=e(FLBuilder._contentClass).find("> .fl-module"),a=e(FLBuilder._contentClass+" .fl-row"+t).find(".fl-row-content > .fl-module"),s=0;for(e(".fl-col-drop-target").remove(),e(".fl-col-group-drop-target").remove(),e(".fl-row-drop-target").remove(),e(FLBuilder._contentClass).append('<div class="fl-drop-target fl-row-drop-target"></div>'),l.prepend('<div class="fl-drop-target fl-row-drop-target"></div>'),l.append('<div class="fl-drop-target fl-drop-target-last fl-row-drop-target fl-row-drop-target-last"></div>'),l.find(".fl-row-content").prepend('<div class="fl-drop-target fl-col-group-drop-target fl-col-group-drop-target-empty"></div>'),FLBuilder._initEmptyRowDropTargets(),r.prepend('<div class="fl-drop-target fl-row-drop-target"></div>'),r.append('<div class="fl-drop-target fl-drop-target-last fl-row-drop-target fl-row-drop-target-last"></div>'),a.append('<div class="fl-drop-target fl-col-group-drop-target"></div>'),a.append('<div class="fl-drop-target fl-drop-target-last fl-col-group-drop-target fl-col-group-drop-target-last"></div>'),s=0;s<i.length;s++)n=(o=i.eq(s)).find("> .fl-col"),o.hasClass("fl-col-group-nested")||(o.append('<div class="fl-drop-target fl-col-group-drop-target"></div>'),o.append('<div class="fl-drop-target fl-drop-target-last fl-col-group-drop-target fl-col-group-drop-target-last"></div>')),n.append('<div class="fl-drop-target fl-col-drop-target"></div>'),n.append('<div class="fl-drop-target fl-drop-target-last fl-col-drop-target fl-col-drop-target-last"></div>');d&&0===i.length&&(i=d.find(".fl-col-group"),d.append('<div class="fl-drop-target fl-col-drop-target"></div>'),d.append('<div class="fl-drop-target fl-drop-target-last fl-col-drop-target fl-col-drop-target-last"></div>'))},_initEmptyRowDropTargets:function(){var t=e(FLBuilder._contentClass+" .fl-row-content:not(:has(*:visible))");e(".fl-row-content-empty").removeClass(".fl-row-content-empty"),t.length&&t.addClass("fl-row-content-empty")},_blockDragHelper:function(e,t){var l=t.clone();return t.clone().insertAfter(t),l.addClass("fl-builder-block-drag-helper"),l},_blockDragInit:function(t){var l=e(t.currentTarget),i=null,o=e(window).scrollTop(),n=0;FLBuilder._dragEnabled=!0,FLBuilder._dragInitialScrollTop=o,l.closest("[data-node]").length>0?(i=l.closest("[data-node]")).addClass("fl-node-drag-init"):l.hasClass("fl-builder-block")&&e(".fl-row").each(function(){null===i&&e(this).offset().top-o>0&&(i=e(this))}),null!==i&&(n=i.offset().top-o),FLBuilder._highlightRowsAndColsForDrag(l),FLBuilder._adjustColHeightsForDrag(),FLBuilder._disableGlobalNodes(),FLBuilder._destroyOverlayEvents(),FLBuilder._initSortables(),e("body").addClass("fl-builder-dragging"),e("body",window.parent.document).addClass("fl-builder-dragging"),e(".fl-builder-empty-message").hide(),e(".fl-sortable-disabled").removeClass("fl-sortable-disabled"),"touchstart"===t.type||e(t.target).hasClass("fl-sortable-proxy-item ")||FLBuilder._removeAllOverlays(),n>0&&scrollTo(0,i.offset().top-n),FLBuilder.triggerHook("didInitDrag")},_blockDragStart:function(t,l){FLBuilder._dragging=!0,e(".fl-node-drag-init").removeClass("fl-node-drag-init"),FLBuilder.triggerHook("didStartDrag")},_blockDragSort:function(t,l){var i=l.placeholder.parent(),o=FLBuilderStrings.insert;if(!FLBuilder._blockPreventSort(l.item,i)){if(e(".fl-sortable-fixed-width").css("max-width","").removeClass("fl-sortable-fixed-width"),i.hasClass("fl-col-content")||i.hasClass("fl-module")||i.hasClass("fl-module-content")||i.data("children-wrapper"))/flex/.test(i.css("display"))&&(l.placeholder.hide(),i.css("max-width",""),i.css("max-width",i.outerWidth()),i.addClass("fl-sortable-fixed-width"),l.placeholder.show()),o=/flex/.test(i.css("display"))&&/row|row-reverse/.test(i.css("flex-direction"))?"":l.item.hasClass("fl-builder-block-row")?l.item.find(".fl-builder-block-title").text():l.item.hasClass("fl-col-sortable-proxy-item")?FLBuilderStrings.column:l.item.hasClass("fl-builder-block-module")||l.item.hasClass("fl-builder-block-saved-module")||l.item.hasClass("fl-builder-block-module-template")?l.item.find(".fl-builder-block-title").text():l.item.data("name");else if(i.hasClass("fl-col-drop-target"))o="";else if(i.hasClass("fl-col-group-drop-target"))o="";else if(i.hasClass("fl-row-drop-target"))if(l.item.hasClass("fl-builder-block-row"))o=l.item.find(".fl-builder-block-title").text();else if(l.item.hasClass("fl-builder-block-saved-row"))o=l.item.find(".fl-builder-block-title").text();else if(l.item.hasClass("fl-builder-block-saved-column"))o=l.item.find(".fl-builder-block-title").text();else if(l.item.hasClass("fl-row-sortable-proxy-item"))o=FLBuilderStrings.row;else if(l.item.hasClass("fl-builder-block-module")||l.item.hasClass("fl-module-sortable-proxy-item")){var n=l.item.data("type"),d=l.item.data("alias"),r=FLBuilderConfig.contentItems.module.filter(e=>d===e.alias&&n===e.slug).pop(),a=!!r&&r.accepts,s=r?r.name:"";o=a&&a.length?s:FLBuilderStrings.newRow}else o=l.item.hasClass("fl-builder-block-saved-module")?l.item.find(".fl-builder-block-title").text():FLBuilderStrings.newRow;l.placeholder.html(o),l.item.hasClass("fl-node-global")||l.item.hasClass("fl-builder-block-global")||e(".fl-node-dragging").hasClass("fl-node-global")?l.placeholder.addClass("fl-builder-drop-zone-global"):l.placeholder.removeClass("fl-builder-drop-zone-global")}},_blockDragChange:function(e,t){FLBuilder._initEmptyRowDropTargets(),t.placeholder.css("opacity","0"),t.placeholder.animate({opacity:"1"},100)},_blockPreventSort:function(t,l){var i=!1,o=t.hasClass("fl-builder-block-row"),n=t.hasClass("fl-col-sortable-proxy-item"),d=t.hasClass("fl-builder-block-module")||t.hasClass("fl-module-sortable-proxy-item"),r=l.data("accepts"),a=l.data("children-wrapper"),s=l.closest(".fl-col[data-template-url]").hasClass("fl-node-global"),u=l.hasClass("fl-col-content"),c=l.hasClass("fl-col-drop-target"),f=l.parents(".fl-col-group:not(.fl-col-group-nested)"),g=l.parents(".fl-col-group-nested"),p=l.data("type"),m=t.data("type");if(r||a){var h=!!(F=FLBuilderConfig.contentItems.module.filter(e=>m===e.slug).pop())&&F.accepts;(o||n||"object"==typeof h&&h.length&&!h.includes(m))&&(i=!0)}if(d&&"widget"!==m){var F,b=!!(F=FLBuilderConfig.contentItems.module.filter(e=>m===e.slug).pop())&&F.parents;"object"!=typeof b||b.includes(p)||(i=!0)}return(o||n)&&u&&g.length>0&&(i=!0),u&&!l.find(".fl-module, .fl-col").length&&(o&&"1-col"==t.data("cols")||n)&&(i=!0),o&&u&&e.inArray(t.data("cols"),["5-cols","6-cols"])>-1&&(i=!0),n&&e(".fl-node-dragging").find(".fl-col-group-nested").length>0&&(u||c&&g.length>0)&&(i=!0),c&&f.length>0&&0===g.length&&f.find("> .fl-col:visible").length>11&&(i=!0),c&&g.length>0&&g.find(".fl-col:visible").length>3&&(i=!0),d&&s&&"column"!==FLBuilderConfig.userTemplateType&&(i=!0),l.closest(".fl-builder-shortcode-mask-wrap").length&&(i=!0),i&&l.addClass("fl-sortable-disabled"),i},_blockDragStop:function(t,l){var i=e(window).scrollTop(),o=l.item.parent(),n=null;n=o.hasClass("fl-drop-target")&&o.closest("[data-node]").length?(o=o.closest("[data-node]")).offset().top-i:o.offset().top-i,o.hasClass("fl-builder-blocks-section-content")&&FLBuilder._showPanel(),FLBuilder._dragEnabled=!1,FLBuilder._dragging=!1,FLBuilder._bindOverlayEvents(),FLBuilder._removeEmptyRowAndColHighlights(),FLBuilder._highlightEmptyCols(),FLBuilder._enableGlobalNodes(),FLBuilder._setupEmptyLayout(),e("body").removeClass("fl-builder-dragging"),e("body",window.parent.document).removeClass("fl-builder-dragging"),scrollTo(0,o.offset().top-n),FLBuilder.triggerHook("didStopDrag")},_blockDragCancel:function(){FLBuilder._dragEnabled&&!FLBuilder._dragging&&(FLBuilder._dragEnabled=!1,FLBuilder._dragging=!1,FLBuilder._bindOverlayEvents(),FLBuilder._removeEmptyRowAndColHighlights(),FLBuilder._highlightEmptyCols(),FLBuilder._enableGlobalNodes(),FLBuilder._setupEmptyLayout(),e("body").removeClass("fl-builder-dragging"),e("body",window.parent.document).removeClass("fl-builder-dragging"),e(".fl-node-drag-init").removeClass("fl-node-drag-init"),e(".fl-node-dragging").removeClass("fl-node-dragging"),scrollTo(0,FLBuilder._dragInitialScrollTop),FLBuilder.triggerHook("didCancelDrag"))},_reorderNode:function(e,t){FL.Builder.getActions().moveNode(e,t)},_reorderNodeComplete:function(e){var t=FLBuilder._jsonParse(e),l="didMove"+t.nodeType.charAt(0).toUpperCase()+t.nodeType.slice(1);FLBuilder.triggerHook("didMoveNode",t),FLBuilder.triggerHook(l,t)},_moveNodeUpClicked:function(t){var l=e(t.target).closest("[data-node]"),i=l.attr("data-node"),o=FL.Builder.data.getNode(i),n=o.position-1,d=l.find(".fl-block-move-up").first(),r=l.find(".fl-block-move-down").first();n<=0?d.addClass("fl-builder-submenu-disabled"):d.removeClass("fl-builder-submenu-disabled"),r.removeClass("fl-builder-submenu-disabled"),FLBuilder._reorderNode(i,n),FLBuilder._selectNodeOverlay(l,!1),FL.Builder.data.updateNode(i,{...o,position:n})},_moveNodeDownClicked:function(t){var l=e(t.target).closest("[data-node]"),i=l.attr("data-node"),o=FL.Builder.data.getNode(i),n=o.position+1,d=l.find(".fl-block-move-up").first(),r=l.find(".fl-block-move-down").first();n>=l.parent().find("> [data-node]").length-1?r.addClass("fl-builder-submenu-disabled"):r.removeClass("fl-builder-submenu-disabled"),d.removeClass("fl-builder-submenu-disabled"),FLBuilder._reorderNode(i,n),FLBuilder._selectNodeOverlay(l,!1),FL.Builder.data.updateNode(i,{...o,position:n})},_moveNode:function(t,l,i){const o=FL.Builder.getActions();e(".fl-node-"+l).attr("data-parent",t),o.moveNode(l,i,t)},_moveNodeComplete:function(e){const t=FLBuilder._jsonParse(e),l="didMove"+t.nodeType.charAt(0).toUpperCase()+t.nodeType.slice(1);FLBuilder.triggerHook("didMoveNode",t),FLBuilder.triggerHook(l,t)},_getJQueryElement:function(t){return e(FLBuilder._contentClass).find('[data-node="'+t+'"]')},_getNodeLayoutDirection:function(e){var t=/flex/.test(e.parent().css("display")),l=/row|row-reverse/.test(e.parent().css("flex-direction")),i=/grid/.test(e.parent().css("display")),o=i&&"1 / 1 / -1 / -1"===e.css("grid-area"),n=1===window.getComputedStyle(e.parent()[0]).getPropertyValue("grid-template-columns").split(" ").length;if(t&&l)return"horizontal";if(i){if(o)return"layered";if(!n)return"horizontal"}return"vertical"},_needsDeleteConfirmation:function(e){if("module"===e.type)return!0;return FLBuilder._getJQueryElement(e.node).find(".fl-module").length>0},_disableGlobalNodes:function(){"row"!==FLBuilderConfig.userTemplateType&&e(".fl-row.fl-node-global").addClass("fl-node-disabled"),"column"!==FLBuilderConfig.userTemplateType&&e(".fl-row:not(.fl-node-global) .fl-col.fl-node-global").addClass("fl-node-disabled"),"module"!==FLBuilderConfig.userTemplateType&&e(".fl-module.fl-node-global[data-accepts][data-template-url]").addClass("fl-node-disabled")},_enableGlobalNodes:function(){e(".fl-node-disabled").removeClass("fl-node-disabled")},_nodeSettingsClicked:function(t){var l=e(this),i=l.attr("data-target-node"),o=FL.Builder.getActions();i||(i=l.parents("[data-node]").attr("data-node")),o.openSettings(i),t.stopPropagation()},_nodeDuplicateClicked:function(t){var l=e(this),i=l.attr("data-target-node"),o=FL.Builder.getActions();i||(i=l.parents("[data-node]").attr("data-node")),o.copyNode(i),t.stopPropagation()},_nodeRemoveClicked:function(t){var l=e(this),i=l.attr("data-target-node"),o=FL.Builder.getActions();i||(i=l.parents("[data-node]").attr("data-node")),o.deleteNode(i),t.stopPropagation()},_rowDragHelper:function(){return e('<div class="fl-builder-block-drag-helper">'+FLBuilderStrings.row+"</div>")},_rowDragInit:function(t){var l=e(t.target),i=e(".fl-row-sortable-proxy-item",window.parent.document),o=l.closest(".fl-row");l.closest(".fl-block-move-menu").length||(o.addClass("fl-node-dragging"),FLBuilder._blockDragInit(t),t.target=i[0],i.trigger(t))},_rowDragInitTouch:function(t){var l=e(t.target),i=e(".fl-row-sortable-proxy-item",window.parent.document),o=l.closest(".fl-row"),n=!1;l.on("touchmove",function(e){n||(t.currentTarget=o[0],FLBuilder._rowDragInit(t),n=!0),e.target=i[0],i.trigger(e)}),l.on("touchend",function(e){e.target=i[0],i.trigger(e),e.stopPropagation()})},_rowDragStart:function(t,l){var i=e(FLBuilder._contentClass).find(".fl-row, .fl-module"),o=e(".fl-node-dragging");1===i.length&&e(FLBuilder._contentClass).addClass("fl-builder-empty"),o.hide(),FLBuilder._blockDragStart(t,l)},_rowDragStop:function(t,l){var i=l.item,o=i.parent(),n=null,d=null,r=0;if(FLBuilder._blockDragStop(t,l),o.hasClass("fl-builder-rows"))i.remove();else if(o.hasClass("fl-row-sortable-proxy"))e(".fl-node-dragging").removeClass("fl-node-dragging").show();else if(i.hasClass("fl-builder-block")){if(o.hasClass("fl-sortable-disabled"))return i.remove(),void FLBuilder._showPanel();o.hasClass("fl-col-content")?FLBuilder._addColGroup(i.closest(".fl-col").attr("data-node"),i.attr("data-cols"),o.find("> .fl-module, .fl-col-group, .fl-builder-block").index(i)):o.hasClass("fl-col-drop-target")?FLBuilder._addCols(o.closest(".fl-col"),o.hasClass("fl-col-drop-target-last")?"after":"before",i.attr("data-cols"),o.closest(".fl-col-group-nested").length>0):o.hasClass("fl-col-group-drop-target")?(d=i.closest(".fl-col-group, .fl-module"),r=i.closest(".fl-row").find(".fl-row-content").find("> .fl-col-group, > .fl-module").index(d),FLBuilder._addColGroup(i.closest(".fl-row").attr("data-node"),i.attr("data-cols"),o.hasClass("fl-drop-target-last")?r+1:r)):(n=i.closest(".fl-row, .fl-module"),r=e(FLBuilder._contentClass).find("> .fl-row, > .fl-module").index(n),r=n.length?r:0,FLBuilder._addRow(i.attr("data-cols"),o.hasClass("fl-drop-target-last")?r+1:r)),i.remove(),FLBuilder._showPanel()}else n=e(".fl-node-dragging").removeClass("fl-node-dragging").show(),o.parent().hasClass("fl-builder-content")||(o.hasClass("fl-drop-target-last")?o.parent().after(n):o.parent().before(n),FLBuilder._reorderNode(n.attr("data-node"),n.index())),e(".fl-row-sortable-proxy",window.parent.document).append(l.item)},_addRow:function(t,l,i){FLBuilder._showNodeLoadingPlaceholder(e(FLBuilder._contentClass),l),FLBuilder._newRowPosition=l;FL.Builder.data.getLayoutActions().addRow(t,l,i)},_addRowComplete:function(t){var l="object"==typeof t?t:FLBuilder._jsonParse(t),i=e(FLBuilder._contentClass),o=e(l.html).data("node");l.nodeParent=i,l.nodePosition=FLBuilder._newRowPosition,FLBuilder._renderLayout(l,function(){FLBuilder._removeNodeLoadingPlaceholder(e(".fl-node-"+o)),FLBuilder.triggerHook("didAddRow",o)})},_deleteRowClicked:function(t){var l=e(t.target).closest(".fl-row").data("node");FL.Builder.getActions().deleteNode(l),t.stopPropagation()},_deleteRow:function(e){var t=e.attr("data-node");FL.Builder.data.getLayoutActions().deleteNode(t),e.empty(),e.remove(),FLBuilder._setupEmptyLayout(),FLBuilder._removeRowOverlays(),FLBuilder.triggerHook("didDeleteRow",t)},_rowCopyClicked:function(t){var l=e(this).closest(".fl-row").attr("data-node");FLBuilder._copyRow(l),t.stopPropagation()},_rowCopySettingsClicked:function(){const t=e(this);let l=t.data("target-node");l||(l=t.closest(".fl-row").data("node")),FLBuilderSettingsCopyPaste._bindCopyToElement(t,"row",l,!0)},_rowPasteSettingsClicked:function(){const t=e(this),l=t.text();let i=t.data("target-node");i||(i=t.closest(".fl-row").data("node"));FLBuilderSettingsCopyPaste._importFromClipboard("row",i)||(t.text(FLBuilderStrings.module_import.error),setTimeout(()=>{t.text(l)},1e3))},_copyRow:function(t){var l=FLBuilder._getJQueryElement(t),i=l.clone(),o=e(".fl-builder-settings[data-node]",window.parent.document),n=o.attr("data-node"),d=n===t?l:l.find('[data-node="'+n+'"]'),r=null;o.length&&d.length&&(r=FLBuilder._getSettings(o),FLBuilderSettingsConfig.nodes[n]=r),i.addClass("fl-node-"+t+"-clone fl-builder-node-clone"),i.find(".fl-block-overlay").remove(),i.removeAttr("data-node"),l.after(i),FLBuilder._showNodeLoading(t+"-clone");i.get(0).scrollIntoView({behavior:"smooth",block:"center"});FL.Builder.data.getLayoutActions().copyRow(t,r,n,function(l){var o=FLBuilder._jsonParse(l);o.nodeParent=e(FLBuilder._contentClass),o.nodePosition=e(FLBuilder._contentClass+" > .fl-row").index(i),o.duplicatedRow=t,o.onAddNewHTML=function(){i.remove()},FLBuilder._rowCopyComplete(o)})},_rowCopyComplete:function(e){FLBuilder._renderLayout(e,function(){FLBuilder.triggerHook("didDuplicateRow",{newNodeId:e.nodeId,oldNodeId:e.duplicatedRow})})},_rowSettingsClicked:function(t){var l=e(this),i=e(this).closest(".fl-row").attr("data-node");l.closest(".fl-block-overlay-global").length;FL.Builder.getActions().openSettings(i),t.stopPropagation()},_showRowSettings:function(t,l){let i=null;l&&"row"!=FLBuilderConfig.userTemplateType?FLBuilderConfig.userCanEditGlobalTemplates&&(i=window.parent.open(e('.fl-row[data-node="'+t+'"]').attr("data-template-url")),i.FLBuilderGlobalNodeId=t):FLBuilderSettingsForms.render({id:"row",nodeId:t,className:"fl-builder-row-settings",attrs:'data-node="'+t+'"',buttons:l||FLBuilderConfig.lite||FLBuilderConfig.simpleUi?[]:["save-as"],badges:l?[FLBuilderStrings.global]:[],settings:FLBuilderSettingsConfig.nodes[t],preview:{type:"row"}},function(){e("#fl-field-width select",window.parent.document).on("change",FLBuilder._rowWidthChanged),e("#fl-field-content_width select",window.parent.document).on("change",FLBuilder._rowWidthChanged),e("#fl-field-aspect_ratio input",window.parent.document).on("input",FLBuilder._rowToggleContentAlignment)})},_rowWidthChanged:function(){var t=e("#fl-field-width select",window.parent.document).val(),l=e("#fl-field-content_width select",window.parent.document).val(),i=e("#fl-field-max_content_width",window.parent.document);"fixed"==t||"full"==t&&"fixed"==l?i.show():i.hide()},_rowToggleContentAlignment:function(t){const l=e("#fl-field-content_alignment",window.parent.document);""===e(t.target).val().trim()?l.hide():l.show()},_resetRowWidthClicked:function(t){var l=e(this).closest(".fl-row"),i=l.attr("data-node"),o=l.find(".fl-row-content"),n=FLBuilderConfig.global.row_width+"px",d=e(".fl-builder-row-settings",window.parent.document);l.hasClass("fl-row-fixed-width")&&l.css("max-width",n),o.css("max-width",n),d.length&&d.find("[name=max_content_width]").val("");FL.Builder.data.getLayoutActions().resetRowWidth(i),FLBuilder._closeAllSubmenus(),FLBuilder.triggerHook("didResetRowWidth",i),t.stopPropagation()},_highlightEmptyCols:function(){var t=FLBuilderConfig.userTemplateType?"":":not(.fl-node-global)",l=e(FLBuilder._contentClass+" .fl-col"+t),i=e(FLBuilder._contentClass+" .fl-module[data-accepts]:not([data-has-children-wrapper])"+t),o=e(FLBuilder._contentClass+" [data-children-wrapper]");l.removeClass("fl-col-highlight").find(".fl-col-content").css("min-height",""),i.removeClass("fl-module-highlight"),o.removeClass("fl-module-highlight"),l.each(function(){var t=e(this);t.find(".fl-module, .fl-col").length||t.closest(".fl-builder-shortcode-mask-wrap").length||t.addClass("fl-col-highlight")}),i.each(function(){var t=e(this);t.find(".fl-module").length||t.closest(".fl-builder-shortcode-mask-wrap").length||t.addClass("fl-module-highlight")}),o.each(function(){var t=e(this);t.find(".fl-module").length||t.closest(".fl-builder-shortcode-mask-wrap").length||t.addClass("fl-module-highlight")})},_highlightRowsAndColsForDrag:function(t){var l="row"==FLBuilderConfig.userTemplateType?"":":not(.fl-node-global)";"column"==FLBuilderConfig.userTemplateType&&(l=":not(:first)"),e(FLBuilder._contentClass+" > .fl-row").addClass("fl-row-highlight"),t&&t.closest(".fl-row-overlay").length||e(FLBuilder._contentClass+" .fl-col"+l).each(function(){e(this).closest(".fl-builder-shortcode-mask-wrap").length||e(this).addClass("fl-col-highlight")});var i=FLBuilder._contentClass+" .fl-module[data-accepts]",o=FLBuilder._contentClass+" [data-children-wrapper]";e(i+", "+o).each(function(){e(this).closest(".fl-builder-shortcode-mask-wrap").length||(e(this).addClass("fl-module-highlight"),0===parseInt(e(this).css("padding"))&&e(this).css("padding","10px"))})},_removeEmptyRowAndColHighlights:function(){e(".fl-row-highlight").removeClass("fl-row-highlight"),e(".fl-col-highlight").removeClass("fl-col-highlight"),e(".fl-module-highlight[data-accepts]").css("padding",""),e(".fl-module-highlight").removeClass("fl-module-highlight"),e(".fl-sortable-fixed-width").css("max-width","").removeClass("fl-sortable-fixed-width")},_adjustColHeightsForDrag:function(){var t="row"==FLBuilderConfig.userTemplateType?"":".fl-row:not(.fl-node-global) ",l="column"==FLBuilderConfig.userTemplateType?"":".fl-col:not(.fl-node-global) ",i=e(FLBuilder._contentClass),o=i.find(t+".fl-col-group:not(.fl-col-group-nested) > "+l+"> .fl-col-content"),n=i.find(t+".fl-col-group-nested "+l+".fl-col-content"),d=0;for(e(".fl-node-drag-init").hide();d<n.length;d++)n.eq(d).closest(".fl-builder-shortcode-mask-wrap").length||FLBuilder._adjustColHeightForDrag(n.eq(d));for(d=0;d<o.length;d++)o.eq(d).closest(".fl-builder-shortcode-mask-wrap").length||FLBuilder._adjustColHeightForDrag(o.eq(d));e(".fl-node-drag-init").show()},_adjustColHeightForDrag:function(e){e.find(".fl-module:visible, .fl-col:visible").length&&e.css("min-height",e.height()+45)},_colDragHelper:function(){return e('<div class="fl-builder-block-drag-helper">'+FLBuilderStrings.column+"</div>")},_colDragInit:function(t){var l=e(t.target),i=e(".fl-col-sortable-proxy-item",window.parent.document),o=l.closest(".fl-col");l.closest(".fl-block-move-menu").length||(l.hasClass("fl-block-col-move-parent")?o=o.parents(".fl-col"):l.data("target-node")&&(o=e(".fl-col[data-node="+l.data("target-node")+"]")),o.addClass("fl-node-dragging"),FLBuilder._blockDragInit(t),t.target=i[0],i.trigger(t))},_colDragInitTouch:function(t){var l=e(t.target),i=e(".fl-col-sortable-proxy-item",window.parent.document),o=l.closest(".fl-col"),n=!1;l.data("target-node")&&(o=e(".fl-col[data-node="+l.data("target-node")+"]")),l.on("touchmove",function(e){n||(t.currentTarget=o[0],FLBuilder._colDragInit(t),n=!0),e.target=i[0],i.trigger(e)}),l.on("touchend",function(e){e.target=i[0],i.trigger(e),e.stopPropagation()})},_colDragStart:function(t,l){var i=e(".fl-node-dragging");i.hide(),FLBuilder._resetColumnWidths(i.parent()),FLBuilder._blockDragStart(t,l)},_colDragStop:function(t,l){FLBuilder._blockDragStop(t,l);var i=e(".fl-node-dragging").removeClass("fl-node-dragging").show(),o=i.attr("data-node"),n=l.item.parent(),d=i.parent(),r=d.attr("data-node");if(newGroup=n.closest(".fl-col-group"),newGroupId=newGroup.attr("data-node"),newRow=n.closest(".fl-row, .fl-module"),position=0,actions=FL.Builder.data.getLayoutActions(),n.closest('[data-node="'+o+'"]').length)FLBuilder._resetColumnWidths(d);else if(n.hasClass("fl-sortable-disabled"))FLBuilder._resetColumnWidths(d);else if(n.hasClass("fl-col-sortable-proxy"))FLBuilder._resetColumnWidths(d);else if(n.hasClass("fl-col-content"))i.remove(),0===d.find(".fl-col").length&&(actions.removeNode(d.attr("data-node")),d.remove()),position=n.find("> .fl-module, .fl-col-group, .fl-col-sortable-proxy-item").index(l.item),FLBuilder._addColGroup(n.closest(".fl-col").attr("data-node"),o,position);else if(n.hasClass("fl-col-drop-target")){n.hasClass("fl-col-drop-target-last")?n.parent().after(i):n.parent().before(i),FLBuilder._resetColumnWidths(newGroup);FL.Builder.data.getLayoutActions();r==newGroupId?FL.Builder.getActions().moveNode(o,i.index()):FL.Builder.getActions().moveNode(o,i.index(),newGroupId,[r,newGroupId]),FLBuilder._resizeLayout()}else n.hasClass("fl-col-group-drop-target")?(i.remove(),0===d.find(".fl-col").length&&(actions.removeNode(d.attr("data-node")),d.remove()),position=newRow.find(".fl-row-content").find(" > .fl-col-group,  > .fl-module").index(newGroup),position=n.hasClass("fl-drop-target-last")?position+1:position,FLBuilder._addColGroup(newRow.attr("data-node"),o,position)):n.hasClass("fl-row-drop-target")&&(i.remove(),position=n.closest(".fl-builder-content").find(".fl-row, > .fl-module").index(newRow),position=n.hasClass("fl-drop-target-last")?position+1:position,FLBuilder._addRow(o,position));0===d.find(".fl-col").length&&(actions.removeNode(d.attr("data-node")),d.remove()),e(".fl-col-sortable-proxy",window.parent.document).append(l.item),FLBuilder._highlightEmptyCols(),FLBuilder._initDropTargets(),FLBuilder._initSortables(),FLBuilder._closeAllSubmenus()},_colSettingsClicked:function(t){var l=e(this),i=l.closest(".fl-col"),o=i.attr("data-node"),n=l.closest(".fl-block-overlay-global").length>0;if(FLBuilder._colResizing)return;if(n&&!FLBuilderConfig.userCanEditGlobalTemplates)return;l.hasClass("fl-block-col-edit-parent")&&(o=i.parents(".fl-col").attr("data-node"));FL.Builder.data.getLayoutActions().displaySettings(o),t.stopPropagation()},_colCopySettingsClicked:function(){const t=e(this);let l=t.data("target-node");l||(l=t.closest(".fl-col").data("node")),FLBuilderSettingsCopyPaste._bindCopyToElement(t,"column",l)},_colPasteSettingsClicked:function(){const t=e(this),l=t.text();let i=t.data("target-node");i||(i=t.closest(".fl-col").data("node"));FLBuilderSettingsCopyPaste._importFromClipboard("column",i)||(t.text(FLBuilderStrings.module_import.error),setTimeout(()=>{t.text(l)},1e3))},_showColSettings:function(t,l,i){if(l&&i&&"row"!==FLBuilderConfig.userTemplateType){if(FLBuilderConfig.userCanEditGlobalTemplates){window.parent.open(e('.fl-col[data-node="'+t+'"]').attr("data-template-url")).FLBuilderGlobalNodeId=t}}else FLBuilderSettingsForms.render({id:"col",nodeId:t,className:"fl-builder-col-settings",attrs:'data-node="'+t+'"',buttons:l||FLBuilderConfig.lite||FLBuilderConfig.simpleUi?[]:["save-as"],badges:l?[FLBuilderStrings.global]:[],settings:FLBuilderSettingsConfig.nodes[t],preview:{type:"col"}},function(){0===e(".fl-col.fl-node-"+t).siblings(".fl-col").length&&e("#fl-field-equal_height, #fl-field-content_alignment",window.parent.document).hide()})},_copyColClicked:function(t){var l=e(this).closest(".fl-col").attr("data-node");FLBuilder._copyColumn(l),t.stopPropagation()},_copyColumn:function(t){var l=FLBuilder._getJQueryElement(t),i=l.clone(),o=l.parent(),n=e(".fl-builder-settings[data-node]",window.parent.document),d=n.attr("data-node"),r=d===t?l:l.find('[data-node="'+d+'"]'),a=null;n.length&&r.length&&(a=FLBuilder._getSettings(n),FLBuilderSettingsConfig.nodes[d]=a),i.addClass("fl-node-"+t+"-clone fl-builder-node-clone"),i.find(".fl-block-overlay").remove(),i.removeAttr("data-node"),l.after(i),FLBuilder._showNodeLoading(t+"-clone"),FLBuilder._resetColumnWidths(o);FL.Builder.data.getLayoutActions().copyColumn(t,a,d,function(e){var l=FLBuilder._jsonParse(e);l.nodeParent=o,l.nodePosition=i.index(),l.duplicatedColumn=t,l.onAddNewHTML=function(){i.remove()},FLBuilder._copyColComplete(l)})},_copyColComplete:function(e){FLBuilder._renderLayout(e,function(){FLBuilder._resetColumnWidths(e.nodeParent),FLBuilder.triggerHook("didDuplicateColumn",{newNodeId:e.nodeId,oldNodeId:e.duplicatedColumn})})},_deleteColClicked:function(t){var l=e(t.target).closest(".fl-col").data("node");FL.Builder.getActions().deleteNode(l),t.stopPropagation()},_getColToDelete:function(e){var t=e,l=t.closest(".fl-col-group"),i=t.parents(".fl-col:not(:has(.fl-builder-content-primary))"),o=i.length>0,n=i.find("> .fl-col-content > .fl-module, > .fl-col-content > .fl-col-group"),d=t.siblings(".fl-col");return o&&1===n.length&&(0===d.length?t=i:1!==d.length||d.find(".fl-module").length||(t=l)),t},_deleteCol:function(e){var t=e.attr("data-node"),l=e.closest(".fl-row"),i=e.closest(".fl-col-group"),o=0;if(e.remove(),rowCols=l.find(".fl-row-content > .fl-col-group > .fl-col, .fl-row-content > .fl-module"),groupCols=i.find(" > .fl-col"),0===rowCols.length&&"row"!=FLBuilderConfig.userTemplateType&&"column"!=FLBuilderConfig.userTemplateType)FLBuilder._deleteRow(l);else{0===groupCols.length?i.remove():(o=6===groupCols.length?16.65:7===groupCols.length?14.28:Math.round(100/groupCols.length*100)/100,groupCols.css("width",o+"%"),FLBuilder.triggerHook("didResetColumnWidths",{cols:groupCols}));FL.Builder.data.getLayoutActions().deleteColumn(t,o),FLBuilder._initDropTargets(),FLBuilder._initSortables(),FLBuilder.triggerHook("col-deleted"),FLBuilder.triggerHook("didDeleteColumn",t)}},_deleteColGroup:function(e){var t=e.attr("data-node");FL.Builder.data.getLayoutActions().deleteNode(t),e.empty(),e.remove(),FLBuilder.triggerHook("didDeleteColumnGroup",t)},_addCols:function(t,l,i,o,n){var d=(t="string"==typeof t?e(".fl-node-"+t):t).closest(".fl-col-group"),r=d.find(".fl-col").index(t),a=t.attr("data-node");i=void 0===i?"1-col":i,o=(o=void 0!==o&&o)?1:0,"after"==l&&r++,FLBuilder._showNodeLoadingPlaceholder(d,r),FLBuilder._removeAllOverlays();FL.Builder.data.getLayoutActions().addColumns(a,l,i,o,n)},_addColsComplete:function(t){var l="object"==typeof t?t:FLBuilder._jsonParse(t);l.nodeParent=FLBuilder._newColParent,l.nodePosition=FLBuilder._newColPosition,FLBuilder._renderLayout(l,function(){FLBuilder._removeNodeLoadingPlaceholder(e(".fl-node-"+l.nodeId)),FLBuilder.triggerHook("didAddColumn",l.nodeId),FLBuilder.triggerHook("didResetColumnWidths",{cols:e(".fl-node-"+l.nodeId).find("> .fl-col")})})},_addColGroup:function(t,l,i,o){var n=e(".fl-node-"+t);FLBuilder._newColGroupPosition=i,n.hasClass("fl-col")?FLBuilder._newColGroupParent=n.find(" > .fl-col-content"):FLBuilder._newColGroupParent=n.find(".fl-row-content"),FLBuilder._showNodeLoadingPlaceholder(FLBuilder._newColGroupParent,i);FL.Builder.data.getLayoutActions().addColumnGroup(t,l,i,o)},_addColGroupComplete:function(t){var l=FLBuilder._jsonParse(t),i=e(l.html),o=i.data("node");i.find(".fl-col").data("node");l.nodeParent=FLBuilder._newColGroupParent,l.nodePosition=FLBuilder._newColGroupPosition,FLBuilder._renderLayout(l,function(){l.nodeParent.hasClass("fl-col-content")&&l.nodeParent.parents(".fl-col").addClass("fl-col-has-cols"),FLBuilder._removeNodeLoadingPlaceholder(e(".fl-node-"+o)),FLBuilder.triggerHook("didAddColumnGroup",o)})},_initColDragResizing:function(){e(".fl-block-col-resize").not(".fl-block-row-resize").draggable({axis:"x",start:FLBuilder._colDragResizeStart,drag:FLBuilder._colDragResize,stop:FLBuilder._colDragResizeStop})},_colDragResizeStart:function(t,l){var i,o,n=e(l.helper),d="",r=n.hasClass("fl-block-col-resize-parent"),a=r?n.closest(".fl-col").parents(".fl-col"):null,s=r?a.parents(".fl-col-group"):n.closest(".fl-col-group"),u=s.find("> .fl-col"),c=r?a:n.closest(".fl-col"),f=c.attr("data-node"),g=e("[data-node="+f+"] #fl-field-size input",window.parent.document),p=null,m=100,h=0,F=null,b=null;for(n.hasClass("fl-block-col-resize-e")?(d="e",p=c.nextAll(".fl-col").first()):(d="w",p=c.prevAll(".fl-col").first()),i=p.attr("data-node"),o=e("[data-node="+i+"] #fl-field-size input",window.parent.document);h<u.length;h++)u.eq(h).data("node")!=c.data("node")&&u.eq(h).data("node")!=p.data("node")&&(m-=parseFloat(u.eq(h)[0].style.width));g.length?(F=g,b="col"):o.length&&(F=o,b="sibling"),FLBuilder._colResizeData={handle:n,feedbackLeft:n.find(".fl-block-col-resize-feedback-left"),feedbackRight:n.find(".fl-block-col-resize-feedback-right"),direction:d,groupWidth:s.outerWidth(),col:c,id:c.attr("data-node"),colWidth:parseFloat(c[0].style.width)/100,sibling:p,siblingId:p.attr("data-node"),offset:l.position.left,availWidth:m,setting:F,settingType:b,layoutActions:FL.Builder.data.getLayoutActions()},FLBuilder._colResizing=!0,e("body").addClass("fl-builder-col-resizing"),FLBuilder._closePanel(),FLBuilder._destroyOverlayEvents(),FLBuilder.triggerHook("col-resize-start")},_colDragResize:function(e,t){var l=FLBuilder._colResizeData,i=FLBuilderConfig.isRtl?"w":"e",o=l.handle.closest(".fl-block-overlay"),n=(l.offset-t.position.left)/l.groupWidth,d=i==l.direction?100*(l.colWidth-n):100*(l.colWidth+n),r=Math.round(100*d)/100,a=l.availWidth-d,s=Math.round(100*a)/100,u=Math.round(100*(l.availWidth-8))/100;r<8?(r=8,s=u):s<8&&(r=u,s=8),l.feedbackLeft.show(),l.feedbackRight.show(),requestAnimationFrame(()=>{i==l.direction?(l.feedbackLeft.html(r.toFixed(1)+"%"),l.feedbackRight.html(s.toFixed(1)+"%")):(l.feedbackLeft.html(s.toFixed(1)+"%"),l.feedbackRight.html(r.toFixed(1)+"%")),l.col.css("width",r+"%"),l.sibling.css("width",s+"%"),l.setting&&("col"===l.settingType?l.setting.val(parseFloat(l.col[0].style.width)):"sibling"===l.settingType&&l.setting.val(parseFloat(l.sibling[0].style.width))),l.layoutActions.resizeColumn(l.id,r,l.siblingId,s,!1),FLBuilder._buildOverlayOverflowMenu(o)}),FLBuilder.triggerHook("col-resize-drag")},_colDragResizeStop:function(t,l){var i=FLBuilder._colResizeData,o=FLBuilder._colResizeData.handle.closest(".fl-block-overlay"),n=i.id,d=parseFloat(i.col[0].style.width),r=i.sibling.data("node"),a=parseFloat(i.sibling[0].style.width);FLBuilder._colResizeData.feedbackLeft.hide(),FLBuilder._colResizeData.feedbackRight.hide();FL.Builder.data.getLayoutActions().resizeColumn(n,d,r,a),FLBuilder._buildOverlayOverflowMenu(o),FLBuilder._colResizeData=null,e("body").removeClass("fl-builder-col-resizing"),FLBuilder._bindOverlayEvents(),setTimeout(function(){FLBuilder._colResizing=!1},50),FLBuilder.triggerHook("col-resize-stop"),FLBuilder.triggerHook("didResizeColumn",{colId:n,colWidth:d,siblingId:r,siblingWidth:a})},_resetColumnWidthsClicked:function(t){var l=e(this),i=!!l.closest(".fl-row-overlay").length,o=null,n=[],d=null,r=0,a=e(".fl-builder-col-settings",window.parent.document),s=null;(i?l.closest(".fl-row").find(".fl-row-content > .fl-col-group"):l.parents(".fl-col-group").last()).each(function(){for(o=e(this),d=o.find(".fl-col-group"),n.push(o.data("node")),FLBuilder._resetColumnWidths(o),r=0;r<d.length;r++)FLBuilder._resetColumnWidths(d.eq(r)),n.push(d.eq(r).data("node"))}),a.length&&(s=e(".fl-node-"+a.attr("data-node")),a.find("#fl-field-size input").val(parseFloat(s[0].style.width)));FL.Builder.data.getLayoutActions().resetColWidths(n),FLBuilder.triggerHook("col-reset-widths"),FLBuilder._closeAllSubmenus(),t.stopPropagation()},_resetColumnWidths:function(t){var l=t;t instanceof jQuery||(l=e(t));var i=l.find(" > .fl-col:visible"),o=0;o=6===i.length?16.65:7===i.length?14.28:Math.round(100/i.length*100)/100,i.css("width",o+"%"),FLBuilder.triggerHook("didResetColumnWidths",{cols:i})},_moduleDragHelper:function(t,l){var i=e(".fl-node-"+l.data("node"));return e('<div class="fl-builder-block-drag-helper">'+i.attr("data-name")+"</div>")},_moduleDragInit:function(t){var l=e(t.target),i=e(".fl-module-sortable-proxy-item",window.parent.document),o=l.closest(".fl-module");l.closest(".fl-block-move-menu").length||(l.data("target-node")&&(o=e(".fl-module[data-node="+l.data("target-node")+"]")),i.data("type",o.data("type")),o.addClass("fl-node-dragging"),FLBuilder._blockDragInit(t),t.target=i[0],i.data("node",o.data("node")),i.data("name",o.data("name")),i.data("type",o.data("type")),i.trigger(t))},_moduleDragInitTouch:function(t){var l=e(t.target),i=e(".fl-module-sortable-proxy-item",window.parent.document),o=l.closest(".fl-module"),n=!1;l.data("target-node")&&(o=e(".fl-module[data-node="+l.data("target-node")+"]")),l.on("touchmove",function(e){n||(t.currentTarget=o[0],FLBuilder._moduleDragInit(t),n=!0),e.target=i[0],i.trigger(e)}),l.on("touchend",function(e){e.target=i[0],i.trigger(e),e.stopPropagation()})},_moduleDragStart:function(t,l){var i=e(".fl-node-dragging");1===e(FLBuilder._contentClass).find(".fl-row, .fl-module").length&&e(FLBuilder._contentClass).addClass("fl-builder-empty"),i.hide(),FLBuilder._removeRowOverlays(),FLBuilder._blockDragStart(t,l)},_moduleDragStop:function(t,l){FLBuilder._blockDragStop(t,l);var i=e(".fl-node-dragging").removeClass("fl-node-dragging"),o=i.attr("data-accepts"),n=l.item,d=l.item.parent(),r=null,a=0,s=0;if(d.hasClass("fl-builder-modules")||d.hasClass("fl-builder-widgets"))n.remove();else{if(n.hasClass("fl-builder-block")){if(d.hasClass("fl-sortable-disabled"))return n.remove(),void FLBuilder._showPanel();if(d.hasClass("fl-row-drop-target"))d=n.closest(".fl-builder-content"),s=0,r=n.closest(".fl-row, .fl-module"),a=d.find(".fl-row, > .fl-module").index(r);else if(d.hasClass("fl-col-group-drop-target"))s=(d=n.closest(".fl-row-content")).closest(".fl-row").attr("data-node"),r=n.closest(".fl-col-group, .fl-module"),a=d.find("> .fl-col-group, > .fl-module").index(r);else if(d.hasClass("fl-col-drop-target"))s=(d=n.closest(".fl-col-group")).attr("data-node"),r=n.closest(".fl-col"),a=d.find(" > .fl-col").index(r);else if(d.hasClass("fl-module")){a="layered"===(c=FLBuilder._getNodeLayoutDirection(n))?d.find("> .fl-module").length:d.find("> .fl-module, .fl-builder-block").index(n),s=d.attr("data-node")}else d.hasClass("fl-module-content")||d.attr("data-children-wrapper")?(a=d.find("> .fl-module, .fl-builder-block").index(n),s=n.closest(".fl-module").attr("data-node")):(a=d.find("> .fl-module, .fl-col-group, .fl-builder-block").index(n),s=n.closest(".fl-col").attr("data-node"));n.closest(".fl-drop-target-last").length&&(a+=1),FLBuilder._addModule(d,s,n.attr("data-type"),a,n.attr("data-widget"),n.attr("data-alias")),n.remove()}else{if(d.hasClass("fl-sortable-disabled"))FLBuilder._highlightEmptyCols(),i.show();else if(d.hasClass("fl-row-drop-target"))r=n.closest(".fl-row, .fl-module"),a=n.closest(".fl-builder-content").children(".fl-row, .fl-module").index(r),a=n.closest(".fl-drop-target-last").length?a+1:a,o?(FLBuilder._moveNode(0,i.attr("data-node"),a),i.show()):(FLBuilder._addRow("1-col",a,i.attr("data-node")),i.remove());else if(d.hasClass("fl-col-group-drop-target"))r=n.closest(".fl-col-group, .fl-module"),a=n.closest(".fl-row-content ").find(" > .fl-col-group, > .fl-module").index(r),a=n.closest(".fl-drop-target-last").length?a+1:a,s=n.closest(".fl-row").attr("data-node"),o?(FLBuilder._moveNode(s,i.attr("data-node"),a),i.show()):(FLBuilder._addColGroup(s,"1-col",a,i.attr("data-node")),i.remove());else if(d.hasClass("fl-col-drop-target"))r=n.closest(".fl-col"),a=n.closest(".fl-col-drop-target-last").length?"after":"before",FLBuilder._addCols(r,a,"1-col",n.closest(".fl-col-group-nested").length>0,i.attr("data-node")),i.remove();else{var u=n.closest("[data-accepts]").length,c=FLBuilder._getNodeLayoutDirection(n);u&&"layered"===c?n.parent().append(i):n.after(i),n.remove(),i.show(),FLBuilder._reorderModule(i)}e(".fl-module-sortable-proxy",window.parent.document).append(n)}FLBuilder._resizeLayout(),FLBuilder._initDropTargets(),FLBuilder.triggerHook("didDropModule")}},_reorderModule:function(e){var t=e.parents(".fl-row, .fl-col, .fl-module").eq(0).attr("data-node"),l=e.attr("data-parent"),i=e.attr("data-node"),o=e.parent().find("> .fl-col-group, > .fl-module").index(e);t==l?FLBuilder._reorderNode(i,o):FLBuilder._moveNode(t,i,o)},_deleteModuleClicked:function(t){var l=e(t.target).closest(".fl-module").data("node");FL.Builder.getActions().deleteNode(l),t.stopPropagation()},_deleteModule:function(e){var t=e.closest(".fl-row"),l=t.find("[data-node]"),i=e.attr("data-node"),o=e.parents("[data-node]").attr("data-node"),n=e.attr("data-accepts");FL.Builder.data.getLayoutActions().deleteNode(i),n&&1===l.length&&FLBuilder._deleteRow(t),e.empty(),e.remove(),t.removeClass("fl-block-overlay-muted"),FLBuilder._setupEmptyLayout(),FLBuilder._highlightEmptyCols(),FLBuilder._removeAllOverlays(),FLBuilder.triggerHook("didDeleteModule",{nodeId:i,parentId:o,moduleType:e.attr("data-type")})},_moduleCopyClicked:function(t){const l=e(this).closest(".fl-module").data("node");FL.Builder.getActions().copyNode(l),t.stopPropagation()},_copyModule:function(t){var l=FLBuilder._getJQueryElement(t),i=l.clone(),o=l.parent(),n=e(".fl-builder-module-settings[data-node="+t+"]",window.parent.document),d={},r=l.length;if(n.length&&(d=FLBuilder._getSettings(n),FLBuilderSettingsConfig.nodes[t]=d),i.addClass("fl-node-"+t+"-clone fl-builder-node-clone"),i.find(".fl-block-overlay").remove(),i.removeAttr("data-node"),1==r&&l.after(i),FLBuilder._showNodeLoading(t+"-clone"),1==r){i.get(0).scrollIntoView({behavior:"smooth",block:"center"})}FL.Builder.data.getLayoutActions().copyModule(t,d,function(e){var l=FLBuilder._jsonParse(e);l.nodeParent=o,l.nodePosition=o.find(" > .fl-col-group, > .fl-module").index(i),l.duplicatedModule=t,l.onAddNewHTML=function(){i.remove()},FLBuilder._moduleCopyComplete(l)})},_moduleCopyComplete:function(e){FLBuilder._renderLayout(e,function(){FLBuilder.triggerHook("didDuplicateModule",{newNodeId:e.nodeId,oldNodeId:e.duplicatedModule,moduleType:e.moduleType})})},_moduleSettingsClicked:function(t){var l=e(this),i=(l.closest(".fl-block-overlay"),l.closest(".fl-module").attr("data-type"),l.closest(".fl-module").attr("data-node")),o=(l.closest(".fl-col").attr("data-node"),l.closest(".fl-block-overlay-global").length>0);if(t.stopPropagation(),FLBuilder._colResizing)return;if(o&&!FLBuilderConfig.userCanEditGlobalTemplates)return;FL.Builder.getActions().openSettings(i)},_moduleCopySettingsClicked:function(){const t=e(this);let l=t.data("target-node");l||(l=t.closest(".fl-module").data("node"));const i=e(".fl-node-"+l).data("type");FLBuilderSettingsCopyPaste._bindCopyToElement(t,i,l)},_modulePasteSettingsClicked:function(){const t=e(this),l=t.text();let i=t.data("target-node");i||(i=t.closest(".fl-module").data("node"));const o=e(".fl-node-"+i).data("type");FLBuilderSettingsCopyPaste._importFromClipboard(o,i)||(t.text(FLBuilderStrings.module_import.error),setTimeout(()=>{t.text(l)},1e3))},_showModuleSettings:function(t,l){if(FLBuilderSettingsConfig.modules){var i=FLBuilderSettingsConfig.modules[t.type],o=t.settings?t.settings:FLBuilderSettingsConfig.nodes[t.nodeId],n=e("head",window.parent.document),d=e('.fl-module[data-node="'+t.nodeId+'"]');t.global&&!FLBuilderConfig.userTemplateType&&d.attr("data-accepts")?FLBuilderConfig.userCanEditGlobalTemplates&&(win=window.parent.open(d.attr("data-template-url")),win.FLBuilderGlobalNodeId=t.nodeId):(-1===e.inArray(t.type,FLBuilder._loadedModuleAssets)&&(""!==i.assets.css&&n.append(i.assets.css),""!==i.assets.js&&n.append(i.assets.js),FLBuilder._loadedModuleAssets.push(t.type)),FLBuilderSettingsForms.render({type:"module",id:t.type,nodeId:t.nodeId,className:"fl-builder-module-settings fl-builder-"+t.type+"-settings",attrs:'data-node="'+t.nodeId+'" data-parent="'+t.parentId+'" data-type="'+t.type+'"',buttons:t.global||FLBuilderConfig.lite||FLBuilderConfig.simpleUi?[]:["save-as"],badges:t.global?[FLBuilderStrings.global]:[],settings:o,legacy:t.legacy,helper:FLBuilder._moduleHelpers[t.type],rules:FLBuilder._moduleHelpers[t.type]?FLBuilder._moduleHelpers[t.type].rules:null,messages:FLBuilder._moduleHelpers[t.type]?FLBuilder._moduleHelpers[t.type].messages:null,hide:!(FLBuilderConfig.userCanEditGlobalTemplates||!t.global),lightbox:t.lightbox?t.lightbox:null,preview:{type:"module",layout:t.layout,callback:function(){FLBuilder._initModuleMarginPlaceholders(),FLBuilder.triggerHook("didAddModule",{nodeId:t.nodeId,moduleType:o.type,settings:o,newNodes:t.newNodes,updatedNodes:t.updatedNodes})}}},l))}},_saveModuleClicked:function(){var t=e(this).closest(".fl-builder-settings"),l=t.attr("data-type"),i=(t.attr("data-node"),FLBuilder._moduleHelpers[l]),o=!0;void 0!==i&&(t.find("label.error").remove(),t.validate().hideErrors(),(o=t.validate().form())&&(o=i.submit())),o?FLBuilder._saveSettings():FLBuilder._toggleSettingsTabErrors()},_addModule:function(e,t,l,i,o,n){FLBuilder._showNodeLoadingPlaceholder(e,i),e.hasClass("fl-col-group")?(FLBuilder._newModuleParent=null,FLBuilder._newModulePosition=0):(FLBuilder._newModuleParent=e,FLBuilder._newModulePosition=i);FL.Builder.data.getLayoutActions().addModule(l,t,i,{widget:void 0===o?"":o,alias:void 0===n?"":n,nodePreview:1})},_addModuleComplete:function(t){var l=FLBuilder._jsonParse(t),i=!1;if(!1===l)return FLBuilder.alert(FLBuilderStrings.savedModuleNotExists),FLBuilder._newModuleParent.find(".fl-builder-node-loading-placeholder").remove(),!1;l.layout&&(FLBuilder._newModuleParent&&FLBuilder._newModuleParent.find(".fl-builder-node-loading-placeholder").remove(),l.layout.nodeParent=FLBuilder._newModuleParent,l.layout.nodePosition=FLBuilder._newModulePosition),l.settings||(l.settings=FLBuilderSettingsConfig.defaults.modules[l.type]),e("form.fl-builder-settings",window.parent.document).length?l.layout&&(FLBuilder._renderLayout(l.layout),i=!0):i=!0,i&&FLBuilder._showModuleSettings(l,function(){e(".fl-builder-module-settings",window.parent.document).data("new-module","1")})},registerModuleHelper:function(t,l){var i={node:null,form:null,rules:{},init:function(){},submit:function(){return!0},preview:function(){},getForm:function(){return this.form||(this.form=e("form.fl-builder-settings:visible",window.parent.document).get(0)),this.form},getSettings:function(){return FLBuilder._getSettings(e(this.form))},getNodeID:function(){return this.getForm().dataset.node},getNode:function(){return this.node||(this.node=document.querySelector(`${FLBuilder._contentClass} .fl-module[data-node="${this.getNodeID()}"]`)),this.node}};FLBuilder._moduleHelpers[t]=e.extend({},i,l)},_registerModuleHelper:function(e,t){FLBuilder.registerModuleHelper(e,t)},_initModuleMarginPlaceholders:function(){var t=e(".fl-builder-module-settings:visible",window.parent.document),l=t.data("node"),i=e(".fl-node-"+l),o=i.find("> .fl-node-content"),n=["top","right","bottom","left"];if(t.length&&i.closest(".fl-module[data-accepts]").length)for(var d in o.length||(o=i),n){var r=t.find('input[name="margin_'+n[d]+'"]');i.removeClass("fl-node-"+l),r.attr("placeholder",parseInt(o.css("margin-"+n[d]))),i.addClass("fl-node-"+l)}},_showNodeTemplateSettings:function(t){var l=e(".fl-builder-settings-lightbox .fl-builder-settings",window.parent.document),i=l.attr("data-node"),o=FLBuilderStrings.saveModule;if(l.hasClass("fl-builder-row-settings")?o=FLBuilderStrings.saveRow:l.hasClass("fl-builder-col-settings")&&(o=FLBuilderStrings.saveColumn),!FLBuilder._triggerSettingsSave(!1,!1,!1))return!1;FLBuilderSettingsForms.render({id:"node_template",nodeId:i,title:o,attrs:'data-node="'+i+'"',className:"fl-builder-node-template-settings",rules:{name:{required:!0}}},function(){var t=e(".fl-builder-settings:visible"),l=FLBuilderConfig.nodeCategoies;select=t.find("#fl-field-categories").find("select"),desc=select.parent().find(".fl-field-description").hide(),e.each(l,function(t,l){select.append(e("<option>",{value:l.id,text:l.name}))}),select.on("change",function(){"add_new"===e(this).val()&&(e('<input type="text" name="categories" value="" class="text text-full">').insertBefore(select),select.remove(),desc.show())}),FLBuilderConfig.userCanEditGlobalTemplates||e("#fl-field-global",window.parent.document).hide()})},_saveNodeTemplate:function(){var t=e(".fl-builder-node-template-settings",window.parent.document),l=t.attr("data-node");if(t.validate().form()){FLBuilder._showNodeLoading(l);FL.Builder.data.getLayoutActions().saveNodeTemplate(l,FLBuilder._getSettings(t)),FLBuilder._lightbox.close()}},_saveNodeTemplateComplete:function(t){var l=FLBuilder._jsonParse(t),i=e(".fl-builder-saved-"+l.type+"s",window.parent.document),o=i.find(".fl-builder-block"),n=null,d="",r=l.name.toLowerCase(),a=0,s=wp.template("fl-node-template-block"),u={name:l.name,isGlobal:l.global,content:l.type,id:l.id,postID:l.postID,kind:"template",type:"user",link:l.link,category:{uncategorized:FLBuilderStrings.uncategorized}};if(FLBuilderConfig.contentItems.template.push(u),FLBuilder.triggerHook("contentItemsChanged"),l.layout&&(FLBuilder._renderLayout(l.layout),FLBuilder.triggerHook("didSaveGlobalNodeTemplate",l.config)),0===o.length)i.append(s(l));else for(;a<o.length;a++){if(d=(n=o.eq(a)).text().toLowerCase().trim(),0===a&&r<d){i.prepend(s(l));break}if(r<d){n.before(s(l));break}if(o.length-1===a){i.append(s(l));break}}i.find(".fl-builder-block-no-node-templates").remove()},_nodeTemplateDragStop:function(t,l){FLBuilder._blockDragStop(t,l);var i=l.item,o=i.parent(),n=null,d=0,r=null,a="",s=null;if(o.hasClass("fl-builder-blocks-section-content"))return void i.remove();if(i.hasClass("fl-builder-block-saved-row")||i.hasClass("fl-builder-block-row-template"))r=i.closest(".fl-row, .fl-module"),d=e(FLBuilder._contentClass).find(".fl-row, > .fl-module").index(r),d=r.length?d:0,d=o.hasClass("fl-drop-target-last")?d+1:d,n=null,a="render_new_row_template",s=FLBuilder._addRowComplete,FLBuilder._newRowPosition=d,FLBuilder._showNodeLoadingPlaceholder(e(FLBuilder._contentClass),d);else if(i.hasClass("fl-builder-block-saved-column")){if(r=i.closest(".fl-col"),colGroup=o.closest(".fl-col-group"),colGroupId=colGroup.attr("data-node"),a="render_new_col_template",s=FLBuilder._addColsComplete,o.hasClass("fl-sortable-disabled"))return i.remove(),void FLBuilder._showPanel();o.hasClass("fl-row-drop-target")?(r=i.closest(".fl-row, .fl-module"),n=0,o=e(FLBuilder._contentClass),d=r.length?o.find(".fl-row, > .fl-module").index(r):0):o.hasClass("fl-col-group-drop-target")?(o=i.closest(".fl-row-content"),n=i.closest(".fl-row").attr("data-node"),d=i.closest(".fl-row").find(".fl-row-content").find(" > .fl-col-group,  > .fl-module").index(i.closest(".fl-col-group, .fl-module"))):o.hasClass("fl-col-drop-target")&&(d=(o=i.closest(".fl-col-group")).children(".fl-col").index(i.closest(".fl-col")),n=o.attr("data-node")),i.closest(".fl-drop-target-last").length&&(d+=1),o.hasClass("fl-col-group")?FLBuilder._newColParent=null:FLBuilder._newColParent=o,FLBuilder._newColPosition=d,FLBuilder._showNodeLoadingPlaceholder(o,d)}else if(i.hasClass("fl-builder-block-saved-module")||i.hasClass("fl-builder-block-module-template")){if(a="render_new_module",s=FLBuilder._addModuleComplete,o.hasClass("fl-sortable-disabled"))return i.remove(),void FLBuilder._showPanel();if(o.hasClass("fl-row-drop-target"))n=0,d=(o=i.closest(".fl-builder-content")).find(".fl-row, > .fl-module").index(i.closest(".fl-row, .fl-module"));else if(o.hasClass("fl-col-group-drop-target"))n=(o=i.closest(".fl-row-content")).closest(".fl-row").attr("data-node"),d=o.find(" > .fl-col-group, > .fl-module").index(i.closest(".fl-col-group, .fl-module"));else if(o.hasClass("fl-col-drop-target"))d=(o=i.closest(".fl-col-group")).children(".fl-col").index(i.closest(".fl-col")),n=o.attr("data-node");else if(o.hasClass("fl-module")){d="layered"===FLBuilder._getNodeLayoutDirection(i)?o.find("> .fl-module").length:o.find("> .fl-module, .fl-builder-block").index(i),n=o.attr("data-node")}else o.hasClass("fl-module-content")||o.hasClass("fl-loop-item")?(d=o.find("> .fl-module, .fl-builder-block").index(i),n=i.closest(".fl-module").attr("data-node")):(d=o.children(".fl-module, .fl-builder-block").index(i),n=i.closest(".fl-col").attr("data-node"));i.closest(".fl-drop-target-last").length&&(d+=1),o.hasClass("fl-col-group")?(FLBuilder._newModuleParent=null,FLBuilder._newModulePosition=0):(FLBuilder._newModuleParent=o,FLBuilder._newModulePosition=d),FLBuilder._showNodeLoadingPlaceholder(o,d)}const u=i.attr("data-id"),c=i.attr("data-type");let f="module";"render_new_col_template"===a&&(f="column"),"render_new_row_template"===a&&(f="row");FL.Builder.data.getLayoutActions().addNodeTemplate(f,u,c,n,d,function(e){var t=FLBuilder._jsonParse(e);a.indexOf("row")>-1?(FLBuilder.triggerHook("didApplyRowTemplateComplete",t.config),s(t.layout)):a.indexOf("col")>-1?(FLBuilder.triggerHook("didApplyColTemplateComplete",t.config),s(t.layout)):(FLBuilder.triggerHook("didApplyModuleTemplateComplete",t.config),s(e))}),i.remove()},_editNodeTemplateClicked:function(t){t.preventDefault(),t.stopPropagation(),window.parent.open(e(this).attr("href"))},_deleteNodeTemplateClicked:function(t){var l=e(t.target),i=l.closest(".fl-builder-blocks-section").find(".fl-builder-blocks-section-content"),o=i.find(".fl-builder-block"),n=l.closest(".fl-builder-block"),d=n.hasClass("fl-builder-block-global"),r=d?FLBuilderStrings.deleteGlobalTemplate:FLBuilderStrings.deleteTemplate,a=null,s=n.attr("data-id");if(confirm(r)){n.remove(),1===o.length&&(n.hasClass("fl-builder-block-saved-row")?i.append('<span class="fl-builder-block-no-node-templates">'+FLBuilderStrings.noSavedRows+"</span>"):i.append('<span class="fl-builder-block-no-node-templates">'+FLBuilderStrings.noSavedModules+"</span>")),n.hasClass("fl-builder-block-global")&&FLBuilder.showAjaxLoader();FL.Builder.data.getLayoutActions().deleteNodeTemplate(s,d),a=_.findIndex(FLBuilderConfig.contentItems.template,{id:n.attr("data-id"),type:"user"}),FLBuilderConfig.contentItems.template.splice(a,1),FLBuilder.triggerHook("contentItemsChanged")}},_initSettingsForms:function(){const t=e(".fl-builder-settings:visible",window.parent.document);FL.Builder.settingsForms.initEvents(t),FLBuilder._CodeFieldSSLCheck(),FLBuilder._initCodeFields(),FLBuilder._initColorPickers(),FLBuilder._initGradientPickers(),FLBuilder._initIconFields(),FLBuilder._initPhotoFields(),FLBuilder._initSelectFields(),FLBuilder._initEditorFields(),FLBuilder._initMultipleFields(),FLBuilder._initAutoSuggestFields(),FLBuilder._initLinkFields(),FLBuilder._initFontFields(),FLBuilder._initPostTypeFields(),FLBuilder._initOrderingFields(),FLBuilder._initTimezoneFields(),FLBuilder._initDimensionFields(),FLBuilder._initFieldPopupSliders(),FLBuilder._initPresetFields(),FLBuilder._initModuleMarginPlaceholders(),FL.Builder.settingsForms.focusFirstSettingsControl(),FLBuilder._calculateSettingsTabsOverflow(),FLBuilder._lightbox._resizeEditors(),e(".fl-builder-settings-fields",window.parent.document).css("visibility","visible"),e(".fl-builder-settings button",window.parent.document).on("click",function(e){e.preventDefault()}),FLBuilder.triggerHook("settings-form-init")},_reinitSettingsForms:function(){FLBuilder._reinitEditorFields(),FLBuilder.triggerHook("settings-form-init")},_destroySettingsForms:function(){FLBuilder._destroyEditorFields(),FLBuilder._hideColorPicker()},_setSettingsFormContent:function(t){e(".fl-legacy-settings",window.parent.document).remove(),e("body",window.parent.document).append(t)},_settingsTabClicked:function(t){var l=e(this),i=l.closest(".fl-builder-settings"),o=l.attr("href").split("#").pop();FLBuilder._resetSettingsTabsState(),i.find(".fl-builder-settings-tab").removeClass("fl-active"),i.find("#"+o).addClass("fl-active"),i.find(".fl-builder-settings-tabs .fl-active").removeClass("fl-active"),i.find("a[href*="+o+"]").addClass("fl-active"),FLBuilderConfig.rememberTab?localStorage.setItem("fl-builder-settings-tab",o):localStorage.setItem("fl-builder-settings-tab",""),FL.Builder.settingsForms.focusFirstSettingsControl(),t.preventDefault()},_resetSettingsTabsState:function(){var t=e(".fl-lightbox:visible",window.parent.document);FLBuilder._hideTabsOverflowMenu(),t.find(".fl-builder-settings-tabs .fl-active").removeClass("fl-active"),t.find(".fl-builder-settings-tabs-overflow-menu .fl-active").removeClass("fl-active"),t.find(".fl-contains-active").removeClass("fl-contains-active")},_calculateTextWidth:function(t){var l=e("<span>").hide().appendTo(document.body);t=e(t),l.text(t.val()||t.text()).css("font",t.css("font"));var i=l.width();return l.remove(),i},_calculateSettingsTabsOverflow:function(){var t=e(".fl-lightbox:visible",window.parent.document),l=t.outerWidth(),i=t.hasClass("fl-lightbox-width-slim"),o=t.find(".fl-builder-settings-tabs"),n=t.find(".fl-builder-settings-tabs-overflow-menu"),d=t.find(".fl-builder-settings-tabs-more"),r=o.find("a"),a=!1,s=l-44,u=0,c=i?10:20;n.html(""),FLBuilder._hideTabsOverflowMenu(),r.removeClass("fl-overflowed"),r.each(function(){if(!e(this).is(":visible"))return!0;if(!a){var t=FLBuilder._calculateTextWidth(this);(u+=t+c+12)>=s&&(a=!0)}if(a){var l=e(this).html(),i=e(this).attr("href"),o="";e(this).hasClass("fl-active")&&(o="fl-active"),e(this).hasClass("error")&&(o+=" error"),""!==o&&(o='class="'+o+'"');var d=e('<a href="'+i+'" '+o+">"+l+"</a>");n.append(d),e(this).addClass("fl-overflowed")}else e(this).removeClass("fl-overflowed")}),a?t.addClass("fl-lightbox-has-tab-overflow"):t.removeClass("fl-lightbox-has-tab-overflow"),n.find(".fl-active").length>0?d.addClass("fl-contains-active"):d.removeClass("fl-contains-active"),n.find(".error").length>0?d.addClass("fl-contains-errors"):d.removeClass("fl-contains-errors")},_settingsTabsToOverflowMenuItemClicked:function(t){var l=e(t.currentTarget,window.parent.document),i=l.attr("href"),o=l.closest(".fl-lightbox-header-wrap").find(".fl-builder-settings-tabs"),n=o.find('a[href="'+i+'"]'),d=o.find(".fl-builder-settings-tabs-more");FLBuilder._resetSettingsTabsState(),n.trigger("click"),l.addClass("fl-active"),d.addClass("fl-contains-active"),FLBuilder._hideTabsOverflowMenu(),t.preventDefault()},_hasOverflowTabs:function(){return e(".fl-lightbox:visible",window.parent.document).find(".fl-builder-settings-tabs-overflow-menu a").length>0},_showTabsOverflowMenu:function(){if(FLBuilder._hasOverflowTabs()){var t=e(".fl-lightbox:visible",window.parent.document);t.find(".fl-builder-settings-tabs-overflow-menu").css("display","flex"),t.find(".fl-builder-settings-tabs-overflow-click-mask").show(),this.isShowingSettingsTabsOverflowMenu=!0}},_hideTabsOverflowMenu:function(){var t=e(".fl-lightbox:visible",window.parent.document);t.find(".fl-builder-settings-tabs-overflow-menu").css("display","none"),t.find(".fl-builder-settings-tabs-overflow-click-mask").hide(),this.isShowingSettingsTabsOverflowMenu=!1},_toggleTabsOverflowMenu:function(e){FLBuilder.isShowingSettingsTabsOverflowMenu?FLBuilder._hideTabsOverflowMenu():FLBuilder._showTabsOverflowMenu(),e.stopPropagation()},_settingsCancelClicked:function(t){var l=e(".fl-builder-lightbox[data-parent]",window.parent.document),i=e(".fl-builder-module-settings",window.parent.document),o=null,n=null,d=null,r=null,a=null,s="column"==FLBuilderConfig.userTemplateType;if(l.length>0)return void FLBuilder._closeNestedSettings();i.length>0&&void 0!==i.data("new-module")?(o=e(FLBuilder.preview.state.html),d=(n=e(".fl-node-"+i.data("node"))).parents(".fl-module[data-accepts]"),r=n.closest(".fl-col"),a=o.find(".fl-node-"+r.data("node")),d.length>0||a.length>0||s?FLBuilder._deleteModule(n):FLBuilder._deleteCol(r)):FLBuilder.preview&&FLBuilder.preview.revert();FL.Builder.data.getLayoutActions().cancelDisplaySettings(),FLBuilder.preview=null,FLLightbox.closeParent(this),FLBuilder.triggerHook("didCancelNodeSettings")},_initSettingsValidation:function(t,l){l||(l={}),e(".fl-builder-settings",window.parent.document).last().validate({ignore:".fl-ignore-validation",rules:t,messages:l,errorPlacement:FLBuilder._settingsErrorPlacement})},_settingsErrorPlacement:function(e,t){e.appendTo(t.parent())},_toggleSettingsTabErrors:function(){for(var t=e(".fl-builder-settings:visible",window.parent.document),l=t.find(".fl-builder-settings-tab"),i=null,o=null,n=0;n<l.length;n++)o=(i=l.eq(n)).find("label.error"),tabLink=t.find(".fl-builder-settings-tabs a[href*="+i.attr("id")+"]"),tabLink.find(".fl-error-icon").remove(),tabLink.removeClass("error"),o.length>0&&(tabLink.append('<span class="fl-error-icon"></span>'),tabLink.addClass("error"));FLBuilder._calculateSettingsTabsOverflow()},_getSettings:function(t){FLBuilder._updateEditorFields();var l=t.serializeArray(),i=0,o=0,n="",d="",r=[],a=null,s={};for(i=0;i<l.length;i++)if(n=l[i].value.replace(/\r/gm,"").replace(/&#39;/g,"'"),"undefined"!==l[i].name&&!(l[i].name.indexOf("flrich")>-1||l[i].name.startsWith("fl_auto_style_")))if(l[i].name.indexOf("[")>-1){for(d=l[i].name.replace(/\[(.*)\]/,""),r=l[i].name.replace(d,"").replace("[","").replaceAll("]","").split("["),void 0===s[d]&&(1===r.length&&""===r[0]?s[d]=[]:s[d]={}),a=s[d],o=0;o<r.length;o++)if(""!==r[o]){if(r.length-2===o&&""===r[r.length-1]){e.inArray(typeof a[r[o]],["undefined","string"])>-1&&(a[r[o]]=[]),a[r[o]].push(n);break}r.length-1===o?a[r[o]]=n:(e.inArray(typeof a[r[o]],["undefined","string"])>-1&&(a[r[o]]={}),a=a[r[o]])}else if(1===r.length){a.push(n);break}}else s[l[i].name]=n;for(d in s)if(void 0!==s["as_values_"+d]){s[d]=e.grep(s["as_values_"+d].split(","),function(e){return""!==e}).join(",");try{delete s["as_values_"+d]}catch(e){}}return e.each(t.find("[name]"),function(t,l){var i=e(l).attr("name").replace(/\[(.*)\]/,"");i in s||"undefined"===i||(s[i]="")}),s=e.extend({},FLBuilder._getOriginalSettings(t),s)},_getSettingsJSONForHTML:function(e){return JSON.stringify(e).replace(/\'/g,"&#39;").replace("<wbr />","<wbr>")},_getOriginalSettings:function(t,l){var i=t.find(".fl-builder-settings-json"),o=t.data("node"),n=FLBuilderSettingsConfig.nodes,d=null,r={};if(o&&n[o]?d=n[o]:i.length&&(d=FLBuilder._jsonParse(i.val().replace(/&#39;/g,"'"))),d)for(key in d)(key.match(/[a-z0-9-_]+$/)&&e("#fl-field-"+key).length||l)&&(r[key]=d[key]);return r},_getSettingsForChangedCheck:function(t,l){var i=FLBuilder._getSettings(l);if(t){var o=e(".fl-node-"+t);if(o.hasClass("fl-module")){var n=o.data("type"),d=FLBuilderSettingsConfig.editables[n];if(d&&FLBuilderSettingsConfig.nodes[t])for(var r in d)i[r]=FLBuilderSettingsConfig.nodes[t][r]}}return i},_saveSettings:function(t){var l=e(".fl-builder-settings-lightbox .fl-builder-settings",window.parent.document),i=l.data("new-module"),o=l.attr("data-node"),n=FLBuilder._getSettings(l),d=FLBuilder.preview;if(!FLBuilder.isUndefined(t)&&FLBuilder.isBoolean(t)||(t=!0),d&&!d._settingsHaveChanged()&&FLBuilder.isUndefined(i))return d.clear(),void FLBuilder._lightbox.close();function r(){FLBuilder._showNodeLoading(o),FLBuilderSettingsConfig.nodes[o]=n;const e=FL.Builder.data.getLayoutActions(),l=FLBuilder._saveSettingsComplete.bind(this,t);e.updateNodeSettings(o,n,l),FLBuilder.triggerHook("didSaveNodeSettings",{nodeId:o,settings:n}),FLBuilder._lightbox.close()}FLBuilderConfig.userCaps.unfiltered_html?r():(FLBuilderSettingsForms.showLightboxLoader(),FLBuilder.ajax({action:"verify_settings",settings:n},function(t){console.log(t),!0===t?r():(console.log(t),msg='<p style="font-weight:bold;text-align:center;">'+FLBuilderStrings.noScriptWarn.heading+"</p>",FLBuilderConfig.userCaps.global_unfiltered_html?msg+="<p>"+FLBuilderStrings.noScriptWarn.global+"</p>":msg+="<p>"+FLBuilderStrings.noScriptWarn.message+"</p>",msg+='<p><div class="fl-diff"></div></p>',msg+="<p>"+FLBuilderStrings.noScriptWarn.footer+"</p>",FLBuilderSettingsForms.hideLightboxLoader(),FLBuilder.alert(msg),data=FLBuilder._jsonParse(t),""!==data.diff&&(e(".fl-diff",window.parent.document).html(data.diff),e(".fl-diff",window.parent.document).prepend("<p>"+FLBuilderStrings.codeErrorDetected+"</p>"),e(".fl-diff .diff-deletedline",window.parent.document).each(function(){e(this).find("del").length<1?e(this).css("background-color","rgb(255, 192, 203, 0.7)").css("padding","10px").css("border","1px solid pink"):e(this).find("del").css("background-color","rgb(255, 192, 203, 0.7)").css("border","1px solid pink")}),console.log("============"),console.log("key: "+data.key),console.log("value: "+data.value),console.log("parsed: "+data.parsed),console.log("============")))}))},_saveSettingsComplete:function(e,t){var l=FLBuilder._jsonParse(t),i=l.layout.nodeType,o=l.layout.moduleType,n="didSave"+i.charAt(0).toUpperCase()+i.slice(1)+"SettingsComplete",d=FLBuilder.preview,r=function(){d&&l.layout.partial&&l.layout.nodeId===d.nodeId&&!FLBuilder._publishAndRemain&&(d.clear(),FLBuilder.preview=null),FLBuilder._publishAndRemain=!1};!0===e?FLBuilder._renderLayout(l.layout,r):r(),FLBuilder.triggerHook("didSaveNodeSettingsComplete",{nodeId:l.node_id,nodeType:i,moduleType:o,settings:l.settings}),FLBuilder.triggerHook(n,{nodeId:l.node_id,nodeType:i,moduleType:o,settings:l.settings})},_triggerSettingsSave:function(t,l,i){var o=FLBuilder._lightbox._node.find("form.fl-builder-settings"),n=FLBuilder._lightbox._node.data("instance-id"),d=FLLightbox._instances[n],r=e(".fl-lightbox-wrap[data-parent]:visible",window.parent.document),a=!1,s=!0;return t=!_.isUndefined(t)&&t,l=!_.isUndefined(l)&&l,(i=_.isUndefined(i)?!t:i)||(FLBuilder._publishAndRemain=!0),o.length&&(r.length&&(r.find(".fl-builder-settings-save").trigger("click"),(r.find("label.error").length||e(".fl-builder-alert-lightbox:visible",window.parent.document).length)&&(s=!1)),s&&!o.validate({ignore:".fl-ignore-validation"}).form()&&(s=!1),a=FLBuilderSettingsForms.settingsHaveChanged(),s&&a&&(t&&d.disableClose(),o.find(".fl-builder-settings-save").trigger("click"),t&&d.enableClose(),(o.find("label.error").length||e(".fl-builder-alert-lightbox:visible",window.parent.document).length)&&(s=!1)),i?(FLBuilder._destroySettingsForms(),!a&&FLBuilder.preview&&(FLBuilder.preview.clear(),FLBuilder.preview=null)):FLBuilderSettingsForms.cacheCurrentSettings(),a||t||d.close()),s?FLBuilder.triggerHook("didTriggerSettingsSave"):(FLBuilder._publishAndRemain=!1,FLBuilder.triggerHook("didFailSettingsSave"),FLBuilder._toggleSettingsTabErrors(),l&&!e(".fl-builder-alert-lightbox:visible",window.parent.document).length&&FLBuilder.alert(FLBuilderStrings.settingsHaveErrors)),s},_refreshSettingsPreviewReference:function(){FLBuilder.preview&&FLBuilder.preview._initElementsAndClasses()},_openNestedSettings:function(t){t.className&&-1===t.className.indexOf("fl-builder-settings-lightbox")&&(t.className+=" fl-builder-settings-lightbox"),t=e.extend({className:"fl-builder-lightbox  fl-builder-settings-lightbox",destroyOnClose:!0,resizable:!0},t);var l=e(".fl-lightbox-wrap:visible",window.parent.document),i=l.find(".fl-lightbox"),o=new FLLightbox(t),n=o._node,d=n.find(".fl-lightbox");return l.hide(),n.attr("data-parent",l.attr("data-instance-id")),d.attr("style",i.attr("style")),o.on("resized",FLBuilder._calculateSettingsTabsOverflow),o.open('<div class="fl-builder-lightbox-loading"></div>'),o},_closeNestedSettings:function(){var t=e(".fl-builder-lightbox[data-parent]:visible",window.parent.document),l=t.find(".fl-lightbox"),i=t.attr("data-instance-id"),o=FLLightbox._instances[i],n=t.attr("data-parent"),d=e('[data-instance-id="'+n+'"]',window.parent.document),r=d.find(".fl-lightbox"),a=d.find("form"),s=FLLightbox._instances[n];o&&(o.on("close",function(){r.attr("style",l.attr("style")),d.show(),s._resize(),d.find("label.error").remove(),a.validate().hideErrors(),FLBuilder._toggleSettingsTabErrors(),FLBuilder._initMultipleFields(),FL?.Builder?.settingsForms.state.pop()}),o.close())},_showHelpTooltip:function(){const t=e(this),l=setTimeout(()=>{t.siblings(".fl-help-tooltip-text").fadeIn(),t.removeData("hoverTimeout")},500);t.data("hoverTimeout",l)},_hideHelpTooltip:function(){const t=e(this),l=t.data("hoverTimeout");l&&(clearTimeout(l),t.removeData("hoverTimeout")),t.siblings(".fl-help-tooltip-text").fadeOut()},_initAutoSuggestFields:function(){var t=e(".fl-builder-settings:visible .fl-suggest-field",window.parent.document),l=null,i=null,o=null,n=[];t.each(function(){""!==(l=e(this)).attr("data-value")&&(FLBuilderSettingsForms.showFieldLoader(l),n.push({name:l.attr("name"),value:l.attr("data-value"),action:l.attr("data-action"),data:l.attr("data-action-data")}))}),n.length?FLBuilder.ajax({action:"get_autosuggest_values",fields:n},function(l){for(o in i=FLBuilder._jsonParse(l))e('.fl-suggest-field[name="'+o+'"]',window.parent.document).attr("data-value",i[o]);t.each(FLBuilder._initAutoSuggestField)}):t.each(FLBuilder._initAutoSuggestField)},_initAutoSuggestField:function(){var t=e(this);t.autoSuggest(FLBuilder._ajaxUrl({fl_action:"fl_builder_autosuggest",fl_as_action:t.data("action"),fl_as_action_data:t.data("action-data"),_wpnonce:FLBuilderConfig.ajaxNonce}),e.extend({},{asHtmlID:t.attr("name"),selectedItemProp:"name",searchObjProps:"name",minChars:2,keyDelay:1e3,fadeOut:!1,usePlaceholder:!0,emptyText:FLBuilderStrings.noResultsFound,showResultListWhenNoMatch:!0,preFill:t.data("value"),queryParam:"fl_as_query",afterSelectionAdd:FLBuilder._updateAutoSuggestField,afterSelectionRemove:FLBuilder._updateAutoSuggestField,selectionLimit:t.data("limit"),canGenerateNewSelections:!1},t.data("args"))),FLBuilderSettingsForms.hideFieldLoader(t)},_updateAutoSuggestField:function(t,l,i){var o=this;e(this).siblings(".as-values").val(i.join(",")).trigger("change"),e(this).parents(".as-selections").sortable({items:":not(.as-original)",update:function(t,l){var i=[];set=o.parents(".as-selections").find("li.as-selection-item"),e.each(set,function(t,l){i.push(e(l).attr("data-value"))}),e(o).siblings(".as-values").val(i.join(",")).trigger("change")}})},_CodeFieldSSLCheck:function(){e("body").append('<div class="sg-test" style="display:none"><svg xmlns="http://www.w3.org/2000/svg"></svg></div>'),"https://www.w3.org/2000/svg"===e(".sg-test").find("svg").attr("xmlns")&&(FLBuilder._codeDisabled=!0),e(".sg-test").remove()},_initCodeFields:function(){FLBuilder._codeDisabled||e(".fl-builder-settings:visible",window.parent.document).find(".fl-code-field").each(FLBuilder._initCodeField)},_initCodeField:function(){var t=e(this),l=t.closest(".fl-builder-settings"),i=t.find("textarea"),o=(i.attr("id"),i.data("editor")),n=i.data("wrap"),d=e("<div>",{position:"absolute",height:20*parseInt(i.attr("rows"),10)}),r=null,a=!(!l.hasClass("fl-builder-global-settings")&&!l.hasClass("fl-builder-layout-settings"));d.insertBefore(i),d.attr("contentEditable",!0),d.addClass("fl-ignore-validation"),i.css("display","none"),ace.require("ace/ext/language_tools"),(r=ace.edit(d[0])).$blockScrolling=1/0,r.getSession().setValue(i.val()),r.getSession().setMode("ace/mode/"+o),n&&r.getSession().setUseWrapMode(!0),r.setOptions(FLBuilderConfig.AceEditorSettings),r.getSession().on("change",function(e){i.val(r.getSession().getValue()).trigger("change"),saveBtn=l.find(".fl-builder-settings-save"),val=r.getSession().getValue(),l.find("#fl-builder-settings-section-bb_js_code").length>0&&"fl-field-bb_js_code"===t.closest(".fl-field").attr("ID")&&(null!==val.match(/<\/iframe>|<\/script>|<meta/gm)?(saveBtn.addClass("fl-builder-settings-error"),saveBtn.on("click",FLBuilder._showCodeFieldCriticalError)):(saveBtn.removeClass("fl-builder-settings-error"),saveBtn.off("click",FLBuilder._showCodeFieldCriticalError)))}),r.getSession().on("changeAnnotation",function(){for(var e=r.getSession().getAnnotations(),i=l.find(".fl-builder-settings-save"),o=l.find(".fl-builder-settings-error"),n=!1,d=0;d<e.length;d++)if(!(e[d].text.indexOf("DOCTYPE")>-1||e[d].text.indexOf("Named entity expected")>-1||e[d].text.indexOf("@supports")>-1)){if("error"===e[d].type){n=!0;break}e[d].text.indexOf("Expected (<color>) but found")>-1&&(e.splice(d,1),r.getSession().setAnnotations(e))}val=r.getSession().getValue(),a&&n&&null!==val.match(/<\/iframe>|<\/script>|<meta/gm)&&(i.addClass("fl-builder-settings-error"),i.on("click",FLBuilder._showCodeFieldCriticalError)),n&&l.find("#fl-builder-settings-section-bb_js_code").length>0&&"fl-field-bb_js_code"===t.closest(".fl-field").attr("ID")&&(i.addClass("fl-builder-settings-error"),i.on("click",FLBuilder._showCodeFieldCriticalError)),n&&!i.hasClass("fl-builder-settings-error")&&o.length&&FLBuilderConfig.CheckCodeErrors&&(i.addClass("fl-builder-settings-error"),i.on("click",FLBuilder._showCodeFieldError)),n||(o.removeClass("fl-builder-settings-error"),o.off("click",FLBuilder._showCodeFieldError),o.off("click",FLBuilder._showCodeFieldCriticalError))}),i.closest(".fl-field").data("editor",r)},_showCodeFieldError:function(t){t.stopImmediatePropagation(),FLBuilder.confirm({message:FLBuilderStrings.codeError,cancel:function(){var t=e(".fl-builder-settings:visible .fl-builder-settings-save",window.parent.document);t.removeClass("fl-builder-settings-error"),t.off("click",FLBuilder._showCodeFieldError),t.trigger("click")},strings:{ok:FLBuilderStrings.codeErrorFix,cancel:FLBuilderStrings.codeErrorIgnore}})},_showCodeFieldCriticalError:function(e){e.stopImmediatePropagation(),FLBuilder.alert(FLBuilderStrings.codeerrorhtml)},_initMultipleFields:function(){e(".fl-builder-settings:visible .fl-builder-field-multiples",window.parent.document).each(function(){var t=e(this),l=null,i=0,o=FLBuilderConfig.isRtl?{left:10}:{right:10},n=t.attr("data-limit")||0,d=t.find("tr").length||0;for(parseInt(n)>0&&d-1>=parseInt(n)?(t.find(".fl-builder-field-copy").hide(),t.find(".fl-builder-field-add").fadeOut()):t.find(".fl-builder-field-copy, .fl-builder-field-add").show();i<t.length;i++)1===(l=t.eq(i).find(".fl-builder-field-multiple")).length?l.eq(0).find(".fl-builder-field-actions").addClass("fl-builder-field-actions-single"):l.find(".fl-builder-field-actions").removeClass("fl-builder-field-actions-single");e(".fl-builder-field-multiples",window.parent.document).sortable({items:".fl-builder-field-multiple",cursor:"move",cursorAt:o,distance:5,opacity:.5,placeholder:"fl-builder-field-dd-zone",stop:FLBuilder._fieldDragStop,tolerance:"pointer",axis:"y"})})},_addFieldClicked:function(){var t=e(this),l=t.attr("data-field"),i=t.closest("tr").siblings("tr[data-field="+l+"]").last(),o=i.clone(),n=o.find(".fl-form-field"),d=null,r=null,a=parseInt(i.find("label span.fl-builder-field-index").html(),10)+1;o.find("th label span.fl-builder-field-index").html(a),o.find(".fl-form-field-preview-text").html(""),o.find(".fl-form-field-before").remove(),o.find(".fl-form-field-after").remove(),o.find("input, textarea, select").val(""),o.find(".fl-color-picker-color").css("background-color","transparent"),o.find(".fl-color-picker-color").addClass("fl-color-picker-empty"),o.find(".fl-global-color-field-uid")&&o.find(".fl-global-color-field-uid").val(FLBuilder._uniqueColorID()),o.find(".picker-mount").empty(),i.after(o);const s=o.closest(".fl-field");FLBuilder._initMultipleFields(),FLBuilder._renumberFields(s),n.length?(d=n.find(".fl-form-field-edit").data("type"),n.find("input").val(JSON.stringify(FLBuilderSettingsConfig.defaults.forms[d])),n.find("input").trigger("change")):(d=(n=t.closest("form.fl-builder-settings")).data("type"))&&n.hasClass("fl-builder-module-settings")?(r=FLBuilderSettingsConfig.defaults.modules[d][l][0],o.find("input, textarea, select").val(r)):t.parents(".fl-field").find("input").trigger("change"),FLBuilder._updateRepeaterFormState(s)},_copyFieldClicked:function(){var t=e(this).closest("tr"),l=(t.data("field"),t.parent()),i=t.clone(),o=parseInt(t.find("label span.fl-builder-field-index").html(),10)+1;i.find("th label span.fl-builder-field-index").html(o),i.find(".fl-global-color-field-uid")&&(i.find(".fl-global-color-field-uid").val(FLBuilder._uniqueColorID()),clone_name=i.find(".fl-global-color-field-input.text").val()+" ("+FLBuilderStrings.copy+")",i.find(".fl-global-color-field-input.text").attr("value",clone_name),i.find(".fl-global-color-field-input.text").text(clone_name)),i.find(".picker-mount").empty(),t.after(i),FLBuilder._renumberFields(t.parent()),FLBuilder._initMultipleFields(),l.find("input").trigger("change"),FLBuilder._updateRepeaterFormState(t.parent()),FLBuilder.preview&&FLBuilder.preview.delayPreview()},_deleteFieldClicked:function(){var t=e(this).closest("tr"),l=t.parent(),i=l.closest(".fl-builder-settings").hasClass("fl-builder-global-styles");confirm(i?FLBuilderStrings.deleteGlobalColorsWarning:FLBuilderStrings.deleteFieldMessage)&&(t.remove(),FLBuilder._renumberFields(l),FLBuilder._initMultipleFields(),l.find("input").trigger("change"),FLBuilder._updateRepeaterFormState(l),FLBuilder.preview&&FLBuilder.preview.delayPreview())},_getRepeaterSetting(e,t){const l=new FormData(t),i=[];return Array.from(l.entries()).filter(([t])=>t.startsWith(e+"[")).map(([e,t],l)=>{const o=e.split("][").map(e=>e.replaceAll("]","").replaceAll("[","")),[n,...d]=o;0===d.length?i[l]=t:d.reduce((e={},l,i)=>(e[l]=void 0!==e[l]?e[l]:{},d.length-1===i&&(e[l]=t),e[l]),i)}),i},_updateRepeaterFormState(e){const{getSnapshot:t,setCurrentForm:l}=FL.Builder.settingsForms.state,i=e.attr("id").replace("fl-field-",""),o=t(),n=o[o.length-1],d=FLBuilder._getRepeaterSetting(i,e.closest("form").get(0));l({...n,settings:{...n.settings,[i]:d}})},_renumberFields:function(t){t.find(".fl-builder-field-multiple").each(function(t,l){e(l).find("th label span.fl-builder-field-index").html(t+1),FLBuilder._renumberFieldAttr(l,"name",t),FLBuilder._renumberFieldAttr(l,"id",t),FLBuilder._renumberFieldAttr(l,"for",t)})},_renumberFieldAttr:function(t,l,i){e(t).find("["+l+"]").each(function(t,o){var n=e(o).attr(l);n=n.replace(/\[(\d+)\]/,"["+i+"]"),e(o).attr(l,n)})},_fieldDragHelper:function(){return e('<div class="fl-builder-field-dd-helper"></div>')},_fieldDragStop:function(e,t){FLBuilder._renumberFields(t.item.parent()),t.item.find("input").trigger("change"),FLBuilder._updateRepeaterFormState(t.item.parent()),FLBuilder.preview&&FLBuilder.preview.delayPreview()},_initSelectFields:function(){var t=e(".fl-builder-settings:visible",window.parent.document).find("select:not(.fl-preview-ignore)");t.on("change",FLBuilder._settingsSelectChanged),t.trigger("change"),t.on("change",FLBuilder._calculateSettingsTabsOverflow);var l=e(".fl-builder-settings:visible",window.parent.document).find(".fl-button-group-field input[type=hidden]:not(.fl-preview-ignore)");l.on("change",FLBuilder._settingsSelectChanged),l.trigger("change"),l.on("change",FLBuilder._calculateSettingsTabsOverflow),FLBuilder.removeHook("settings-form-init",FLBuilder._initSelectFieldSetFields),FLBuilder.addHook("settings-form-init",FLBuilder._initSelectFieldSetFields)},_settingsSelectChanged:function(t){var l=e(this),i=l.attr("data-root-name"),o=l.attr("data-toggle"),n=l.attr("data-hide"),d=l.attr("data-trigger"),r=(l.attr("data-set"),l.val()),a=0,s=FLBuilderResponsiveEditing._mode,u=l.closest(".fl-field-responsive-setting"),c="fl-field-responsive-setting-"+s,f=!1;if(""===r&&i){const e=FLBuilderSettingsForms.getField(i),t=e?.getInheritedValue(s);r=t||r}if(!u.length||l.parent().hasClass(c)||l.parent().parent().hasClass(c)){if(void 0!==o){for(a in f=!0,o=FLBuilder._jsonParse(o))f&&(FLBuilder._settingsSelectToggle(o[a].fields,"hide","#fl-field-"),FLBuilder._settingsSelectToggle(o[a].sections,"hide","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(o[a].tabs,"hide","a[href*=fl-builder-settings-tab-","]"));void 0!==o[r]&&f&&(FLBuilder._settingsSelectToggle(o[r].fields,"show","#fl-field-"),FLBuilder._settingsSelectToggle(o[r].sections,"show","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(o[r].tabs,"show","a[href*=fl-builder-settings-tab-","]"))}if(void 0!==n){for(a in n=FLBuilder._jsonParse(n))FLBuilder._settingsSelectToggle(n[a].fields,"show","#fl-field-"),FLBuilder._settingsSelectToggle(n[a].sections,"show","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(n[a].tabs,"show","a[href*=fl-builder-settings-tab-","]");void 0!==n[r]&&(FLBuilder._settingsSelectToggle(n[r].fields,"hide","#fl-field-"),FLBuilder._settingsSelectToggle(n[r].sections,"hide","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(n[r].tabs,"hide","a[href*=fl-builder-settings-tab-","]"))}if(void 0!==d&&void 0!==(d=FLBuilder._jsonParse(d))[r]&&void 0!==d[r].fields)for(a=0;a<d[r].fields.length;a++)e("#fl-field-"+d[r].fields[a]).find("select").trigger("change")}},_settingsSelectToggle:function(t,l,i,o){var n=0;if(o=void 0===o?"":o,void 0!==t)for(;n<t.length;n++)e(".fl-builder-settings:visible",window.parent.document).find(i+t[n]+o)[l](),e(i+t[n]+o).parent().find('.fl-field[data-type="code"]').each(function(){!FLBuilder._codeDisabled&&e(this).data("editor")&&e(this).data("editor").resize()})},_initSelectFieldSetFields:function(){var t=e(".fl-builder-settings:visible",window.parent.document).find("select:not(.fl-preview-ignore)"),l=e(".fl-builder-settings:visible",window.parent.document).find(".fl-button-group-field input[type=hidden]:not(.fl-preview-ignore)");t.on("change",FLBuilder._settingsSelectSetFields),l.on("change",FLBuilder._settingsSelectSetFields)},_settingsSelectSetFields:function(){var t=e(this),l=(t.attr("data-root-name"),t.attr("data-set")),i=t.val(),o=FLBuilderResponsiveEditing._mode;if(void 0!==l&&void 0!==(l=FLBuilder._jsonParse(l))[i])for(let e in l[i]){const t=FLBuilderSettingsForms.getField(e),n=l[i][e];if("object"==typeof n)for(let e in n)t.setSubValue(e,n[e],o);else t.setValue(n,o)}},_toggleForm:function(){e(".fl-builder-settings:visible",window.parent.document).find("select:visible, .fl-button-group-field:visible input[type=hidden]:not(.fl-preview-ignore)").each(function(){if(this.hasAttribute("data-toggle")){const e=FLBuilder._jsonParse(this.getAttribute("data-toggle")),t=FLBuilder._jsonParse(this.getAttribute("data-hide")),l=this.getAttribute("data-root-name");let i=this.value;if(""===i&&l){const e=FLBuilderSettingsForms.getField(l),t=e?.getInheritedValue(FLBuilderResponsiveEditing._mode);i=t||i}if(e){for(let t in e)FLBuilder._settingsSelectToggle(e[t].fields,"hide","#fl-field-"),FLBuilder._settingsSelectToggle(e[t].sections,"hide","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(e[t].tabs,"hide","a[href*=fl-builder-settings-tab-","]");void 0!==e[i]&&(FLBuilder._settingsSelectToggle(e[i].fields,"show","#fl-field-"),FLBuilder._settingsSelectToggle(e[i].sections,"show","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(e[i].tabs,"show","a[href*=fl-builder-settings-tab-","]"))}if(t){for(let e in t)FLBuilder._settingsSelectToggle(t[e].fields,"show","#fl-field-"),FLBuilder._settingsSelectToggle(t[e].sections,"show","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(t[e].tabs,"show","a[href*=fl-builder-settings-tab-","]");void 0!==t[i]&&(FLBuilder._settingsSelectToggle(t[i].fields,"hide","#fl-field-"),FLBuilder._settingsSelectToggle(t[i].sections,"hide","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(t[i].tabs,"hide","a[href*=fl-builder-settings-tab-","]"))}}})},_initColorPickers:function(){FLBuilder.colorPicker?FLBuilder.colorPicker._init():(FLBuilder.colorPicker=new FLBuilderColorPicker({mode:"hsv",elements:".fl-color-picker .fl-color-picker-value",presets:FLBuilderConfig.colorPresets?FLBuilderConfig.colorPresets:[],globals:function(){var e=FLBuilderConfig.styles,t=FLBuilderConfig.themeJSON;return{bb:e?e.colors:[],wp:t&&t.color.palette.default?t.color.palette.default:[],theme:t&&t.color.palette.theme?t.color.palette.theme:[]}},labels:{colorPresets:FLBuilderStrings.colorPresets,colorPicker:FLBuilderStrings.colorPicker,placeholder:FLBuilderStrings.placeholder,removePresetConfirm:FLBuilderStrings.removePresetConfirm,noneColorSelected:FLBuilderStrings.noneColorSelected,alreadySaved:FLBuilderStrings.alreadySaved,noPresets:FLBuilderStrings.noPresets,presetAdded:FLBuilderStrings.presetAdded}}),e(FLBuilder.colorPicker).on("presetRemoved presetAdded presetSorted",function(e,t){FLBuilder.ajax({action:"save_color_presets",presets:t.presets})}))},_hideColorPicker:function(){e(".fl-color-picker-ui.fl-color-picker-active",window.parent.document).removeClass("fl-color-picker-active")},_initGradientPickers:function(){e(".fl-builder-settings:visible .fl-gradient-picker",window.parent.document).each(FLBuilder._initGradientPicker)},_initGradientPicker:function(){var t=e(this),l=t.find(".fl-gradient-picker-type-select"),i=t.find(".fl-gradient-picker-angle-wrap"),o=t.find(".fl-gradient-picker-position");l.on("change",function(){"linear"===e(this).val()?(i.show(),o.hide()):(i.hide(),o.show())})},_uniqueColorID:function(){const e="abcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let l=0;l<9;l++){const l=Math.floor(36*Math.random());t+=e.charAt(l)}return t},_initPhotoFields:function(){var t=e(".fl-builder-settings:visible",window.parent.document).find(".fl-photo-field select");t.on("change",FLBuilder._toggleSettingsOnIconChange),t.trigger("change")},_initSinglePhotoSelector:function(){null===FLBuilder._singlePhotoSelector&&(FLBuilder._singlePhotoSelector=wp.media({title:FLBuilderStrings.selectPhoto,button:{text:FLBuilderStrings.selectPhoto},library:{type:FLBuilderConfig.uploadTypes.image},multiple:!1}),FLBuilder._singlePhotoSelector.on("open",FLBuilder._wpmedia_reset_errors),window.parent._wpPluploadSettings.defaults.multipart_params.fl_upload_type="photo")},_selectSinglePhoto:function(){if(!FLBuilderConfig.userCaps.canUpload)return FLBuilder.alert(FLBuilderStrings.uploadBlocked),!1;FLBuilder._initSinglePhotoSelector(),FLBuilder._singlePhotoSelector.once("open",e.proxy(FLBuilder._singlePhotoOpened,this)),FLBuilder._singlePhotoSelector.once("select",e.proxy(FLBuilder._singlePhotoSelected,this)),FLBuilder._singlePhotoSelector.open()},_singlePhotoOpened:function(){var t=FLBuilder._singlePhotoSelector.state().get("selection"),l=e(this).closest(".fl-photo-field"),i=l.find("input[type=hidden]"),o=i.val(),n=null;e(this).hasClass("fl-photo-replace")?(t.reset(),l.addClass("fl-photo-empty"),i.val("")):""!==o?((n=wp.media.attachment(o)).fetch(),t.add(n?[n]:[])):t.reset()},_singlePhotoSelected:function(){var t=FLBuilder._singlePhotoSelector.state().get("selection").first().toJSON(),l=e(this).closest(".fl-photo-field"),i=l.find("input[type=hidden]"),o=l.find(".fl-photo-preview img"),n=l.find("select");t.url&&t.url.endsWith(".svg")&&(t.sizes={full:{url:t.url,filename:t.url.split("/").pop(),height:"",width:""}}),i.val(t.id),o.attr("src",FLBuilder._getPhotoSrc(t)),l.removeClass("fl-photo-empty").removeClass("fl-photo-no-attachment"),l.find("label.error").remove(),n.show(),n.html(FLBuilder._getPhotoSizeOptions(t,n.val())),n.trigger("change"),FLBuilderSettingsConfig.attachments[t.id]=t},_singlePhotoRemoved:function(){FLBuilder._initSinglePhotoSelector();var t=FLBuilder._singlePhotoSelector.state(),l=void 0!==t?t.get("selection"):null,i=e(this).closest(".fl-photo-field"),o=i.find("input[type=hidden]"),n=i.find("select");l&&l.reset(),i.addClass("fl-photo-empty"),o.val(""),n.html('<option value="" selected></option>'),n.trigger("change")},_getPhotoSrc:function(e){return void 0===e.sizes?e.url:void 0!==e.sizes.thumbnail?e.sizes.thumbnail.url:e.sizes.full.url},_getPhotoSizeOptions:function(e,t){var l="",i=null,o=null,n=!1,d="",r="",a={full:FLBuilderStrings.fullSize,large:FLBuilderStrings.large,medium:FLBuilderStrings.medium,thumbnail:FLBuilderStrings.thumbnail};if(void 0===e.sizes||0===e.sizes.length)l+='<option value="'+e.url+'">'+FLBuilderStrings.fullSize+"</option>";else{for(sizecheck in t&&(t=t.split(/[\\/]/).pop()),selectedverified=!1,e.sizes)if(e.sizes[sizecheck].url.split(/[\\/]/).pop()===t){selectedverified=!0;break}for(i in selectedverified||(t=!1),e.sizes)o="",d=void 0!==a[i]?a[i]:void 0!==FLBuilderConfig.customImageSizeTitles[i]?FLBuilderConfig.customImageSizeTitles[i]:"",t?t!==e.sizes[i].url.split(/[\\/]/).pop()||n||(o=' selected="selected"',n=!0):(void 0===FLBuilderConfig.photomodulesize||i!==FLBuilderConfig.photomodulesize||n)&&(i!=FLBuilderConfig.defaultImageSize||n)||(o=' selected="selected"',n=!0),e.sizes[i].width&&e.sizes[i].height&&(d=d?d+" - ":d,r=e.sizes[i].width+" x "+e.sizes[i].height),l+='<option data-size="'+i+'" value="'+e.sizes[i].url+'"'+o+">"+d+r+"</option>"}return l},_selectMultiplePhotos:function(){var t=e(this).closest(".fl-multiple-photos-field").find("input[type=hidden]").val(),l=""===t?"":FLBuilder._jsonParse(t),i=wp.media.gallery.defaults.id,o='[gallery ids="-1"]',n=null,d=null,r=null,a=null,s=[];if(!FLBuilderConfig.userCaps.canUpload)return FLBuilder.alert(FLBuilderStrings.uploadBlocked),!1;if("object"==typeof l){for(a in l)s.push(l[a]);o='[gallery ids="'+s.join()+'"]'}n=wp.shortcode.next("gallery",o).shortcode,_.isUndefined(n.get("id"))&&!_.isUndefined(i)&&n.set("id",i),d=wp.media.gallery.attachments(n),(r=new wp.media.model.Selection(d.models,{props:d.props.toJSON(),multiple:!0})).gallery=d.gallery,r.more().done(function(){r.length||FLBuilder._multiplePhotoSelector.setState("gallery-library"),r.props.set({query:!1}),r.unmirror(),r.props.unset("orderby")}),FLBuilder._multiplePhotoSelector&&FLBuilder._multiplePhotoSelector.dispose(),window.parent._wpPluploadSettings.defaults.multipart_params.fl_upload_type="photo",FLBuilder._multiplePhotoSelector=wp.media({frame:"post",state:e(this).hasClass("fl-multiple-photos-edit")?"gallery-edit":"gallery-library",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:r}).open(),e(FLBuilder._multiplePhotoSelector.views.view.el).addClass("fl-multiple-photos-lightbox"),FLBuilder._multiplePhotoSelector.once("update",e.proxy(FLBuilder._multiplePhotosSelected,this))},_multiplePhotosSelected:function(t){for(var l=e(this).closest(".fl-multiple-photos-field"),i=l.find("input[type=hidden]"),o=l.find(".fl-multiple-photos-count"),n=[],d=0;d<t.models.length;d++)n.push(t.models[d].id);1==n.length?o.html("1 "+FLBuilderStrings.photoSelected):o.html(n.length+" "+FLBuilderStrings.photosSelected),l.removeClass("fl-multiple-photos-empty"),l.find("label.error").remove(),i.val(JSON.stringify(n)).trigger("change")},_initSingleVideoSelector:function(){if(null===FLBuilder._singleVideoSelector){var e=window.parent._wpPluploadSettings.defaults.filters.mime_types[0].extensions;window.parent._wpPluploadSettings.defaults.multipart_params.fl_upload_type="video",window.parent._wpPluploadSettings.defaults.filters.mime_types[0].extensions=FLBuilderConfig.uploadTypes.videoTypes,FLBuilder._singleVideoSelector=wp.media({title:FLBuilderStrings.selectVideo,button:{text:FLBuilderStrings.selectVideo},library:{type:["video/mp4","video/webm"]},multiple:!1}),FLBuilder._singleVideoSelector.on("open",FLBuilder._wpmedia_reset_errors),FLBuilder._singleVideoSelector.on("close",function(){window.parent._wpPluploadSettings.defaults.filters.mime_types[0].extensions=e})}},_selectSingleVideo:function(){if(!FLBuilderConfig.userCaps.canUpload)return FLBuilder.alert(FLBuilderStrings.uploadBlocked),!1;FLBuilder._initSingleVideoSelector(),FLBuilder._singleVideoSelector.once("select",e.proxy(FLBuilder._singleVideoSelected,this)),FLBuilder._singleVideoSelector.open()},_singleVideoSelected:function(){var t=FLBuilder._singleVideoSelector.state().get("selection").first().toJSON(),l=e(this).closest(".fl-video-field"),i=l.find(".fl-video-preview-img"),o=l.find(".fl-video-preview-filename"),n=l.find("input[type=hidden]");i.html('<span class="dashicons dashicons-media-video"></span>'),o.html(t.filename),l.removeClass("fl-video-empty"),l.find("label.error").remove(),n.val(t.id).trigger("change"),FLBuilderSettingsConfig.attachments[t.id]=t},_singleVideoRemoved:function(){FLBuilder._initSingleVideoSelector();var t=FLBuilder._singleVideoSelector.state(),l=void 0!==t?t.get("selection"):null,i=e(this).closest(".fl-video-field"),o=i.find(".fl-video-preview-img img"),n=i.find(".fl-video-preview-filename"),d=i.find("input[type=hidden]");l&&l.reset(),o.attr("src",""),n.html(""),i.addClass("fl-video-empty"),d.val("").trigger("change")},_selectMultipleAudios:function(){var t=e(this).closest(".fl-multiple-audios-field").find("input[type=hidden]").val(),l=""==t?'[playlist ids="-1"]':'[playlist ids="'+FLBuilder._jsonParse(t).join()+'"]',i=wp.shortcode.next("playlist",l).shortcode,o=wp.media.playlist.defaults.id,n=null,d=null;if(_.isUndefined(i.get("id"))&&!_.isUndefined(o)&&i.set("id",o),!FLBuilderConfig.userCaps.canUpload)return FLBuilder.alert(FLBuilderStrings.uploadBlocked),!1;window.parent._wpPluploadSettings.defaults.multipart_params.fl_upload_type="audio",n=wp.media.playlist.attachments(i),(d=new wp.media.model.Selection(n.models,{props:n.props.toJSON(),multiple:!0})).playlist=n.playlist,d.more().done(function(){d.props.set({query:!1}),d.unmirror(),d.props.unset("orderby")}),FLBuilder._multipleAudiosSelector&&FLBuilder._multipleAudiosSelector.dispose(),FLBuilder._multipleAudiosSelector=wp.media({frame:"post",state:e(this).hasClass("fl-multiple-audios-edit")?"playlist-edit":"playlist-library",title:wp.media.view.l10n.editPlaylistTitle,editing:!0,multiple:!0,selection:d}).open(),FLBuilder._multipleAudiosSelector.content.get("view").sidebar.unset("playlist"),FLBuilder._multipleAudiosSelector.on("content:render:browse",function(e){e&&e.sidebar.on("ready",function(){e.sidebar.unset("playlist")})}),FLBuilder._multipleAudiosSelector.once("update",e.proxy(FLBuilder._multipleAudiosSelected,this))},_multipleAudiosSelected:function(t){for(var l=e(this).closest(".fl-multiple-audios-field"),i=l.find(".fl-multiple-audios-count"),o=l.find("input[type=hidden]"),n=[],d=0;d<t.models.length;d++)n.push(t.models[d].id);1==n.length?i.html("1 "+FLBuilderStrings.audioSelected):i.html(n.length+" "+FLBuilderStrings.audiosSelected),o.val(JSON.stringify(n)).trigger("change"),l.removeClass("fl-multiple-audios-empty"),l.find("label.error").remove()},_initIconFields:function(){var t=e(".fl-builder-settings:visible",window.parent.document).find(".fl-icon-field input");t.on("change",FLBuilder._toggleSettingsOnIconChange),t.trigger("change")},_toggleSettingsOnIconChange:function(){var t=e(this),l=t.val(),i=t.attr("data-show");void 0!==i&&(i=FLBuilder._jsonParse(i),FLBuilder._settingsSelectToggle(i.fields,"hide","#fl-field-"),FLBuilder._settingsSelectToggle(i.sections,"hide","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(i.tabs,"hide","a[href*=fl-builder-settings-tab-","]"),l&&(FLBuilder._settingsSelectToggle(i.fields,"show","#fl-field-"),FLBuilder._settingsSelectToggle(i.sections,"show","#fl-builder-settings-section-"),FLBuilder._settingsSelectToggle(i.tabs,"show","a[href*=fl-builder-settings-tab-","]"),FLBuilder._calculateSettingsTabsOverflow()))},_selectIcon:function(){var e=this;FLIconSelector.open(function(t){FLBuilder._iconSelected.apply(e,[t])})},_iconSelected:function(t){var l=e(this).closest(".fl-icon-field"),i=l.find("input[type=hidden]"),o=l.find("i"),n=o.attr("data-icon");i.val(t).trigger("change"),o.removeClass(n),o.addClass(t),o.attr("data-icon",t),l.removeClass("fl-icon-empty"),l.find("label.error").remove()},_removeIcon:function(){var t=e(this).closest(".fl-icon-field"),l=t.find("input[type=hidden]"),i=t.find("i");l.val("").trigger("change"),i.removeClass(),i.attr("data-icon",""),t.addClass("fl-icon-empty")},_formFieldClicked:function(){var t=e(this),l=t.attr("data-type"),i=t.siblings("input"),o=i.attr("name").replace(/\[(.*)\]/,""),n=i.val(),d=t.closest(".fl-builder-field-multiple"),r=d.length?d.index(".fl-builder-field-multiple"):null,a=FLBuilderSettingsConfig.defaults.forms[l];if(FLBuilder.isBlockEditor())return n=JSON.parse(n),n=JSON.stringify({...a,...n}),void FLBuilder.triggerHook("renderFormFieldSettings",[l,n,i,o,r]);""===n&&(n=JSON.stringify(a),i.val(n));var s=FLBuilder._openNestedSettings({className:"fl-builder-lightbox fl-form-field-settings"});FLBuilder._renderFormFieldSettings(l,n,i,s,function(){FLBuilderResponsiveEditing._switchAllSettingsToCurrentMode()})},_renderFormFieldSettings:function(t,l,i,o,n){var d=e(".fl-builder-settings:visible"),r=i.siblings("a"),a=FLBuilder._moduleHelpers[t];FLBuilderSettingsConfig.forms[t];FLBuilder.preview?.preview(),FLBuilderSettingsForms.render({id:t,nodeId:d.attr("data-node"),nodeSettings:FLBuilder._getSettings(d),settings:FLBuilder._jsonParse(l.replace(/&#39;/g,"'")),lightbox:o,rules:a?a.rules:null,helper:{init:function(){var l=e(".fl-builder-settings:visible");r.attr("id","fl-"+l.attr("data-instance-id")),l.attr("data-type",t),a&&a.init(),FLBuilder._initFormFieldSettingsPreview()}}},n)},_saveFormFieldClicked:function(){var t=e(this).closest(".fl-builder-settings");FLBuilder._saveFormFieldSettings(t)?FLBuilder._closeNestedSettings():FLBuilder._toggleSettingsTabErrors()},_initFormFieldSettingsPreview:function(){var t=e(".fl-builder-settings:visible"),l=t.find(".fl-field"),i=t.find("textarea.wp-editor-area");t.on("input","input:not([type=hidden]), textarea",FLBuilder._previewFormFieldSettings),t.on("change","input[type=hidden], select",FLBuilder._previewFormFieldSettings);var o=l.find("input[name=shape_name]"),n=l.find("input[name=shape_original]");o.length>0&&(n.hide(),o.on("keyup",function(){FLBuilder._shapesEdited=!0}),o.val().length>0&&n.val().length<1&&n.val(o.val())),void 0!==window.parent.tinyMCE&&i.each(function(t,l){(l=window.parent.tinyMCE.get(e(l).attr("id"))).on("change",FLBuilder._previewFormFieldSettings),l.on("keyup",FLBuilder._previewFormFieldSettings)})},_previewFormFieldSettings:function(){var t=this.formElement?this.formElement:this,l=e(t).closest(".fl-builder-settings"),i=l.data("timeout");i&&clearTimeout(i),i=setTimeout(function(){FLBuilder._saveFormFieldSettings(l)},1e3),l.data("timeout",i)},_saveFormFieldSettings:function(t){var l=t.attr("data-instance-id"),i=t.attr("data-type"),o=FLBuilder._getSettings(t),n={},d=FLBuilder._moduleHelpers[i],r=e(".fl-builder-settings #fl-"+l,window.parent.document),a=r.parent().attr("data-preview-text"),s=r.parent().attr("data-preview-image"),u=[],c="",f=null,g="",p=null,m=document.createElement("div"),h=!0;a&&(u=a.split(","));for(var F=0;F<u.length;F++)if(o[u[F]]){g=o[c=u[F]],f=t.find("#fl-field-"+c),p=e('select[name="'+c+'"]',window.parent.document);break}return s&&(s=o[s]),p&&p.length>0&&(g=p.find('option[value="'+g+'"]').text()),void 0!==d&&(t.find("label.error").remove(),t.validate().hideErrors(),(h=t.validate().form())&&(h=d.submit())),!!h&&(void 0!==a&&void 0!==g&&("icon"===f?.data("type")?g='<i class="'+FLBuilderSettingsForms.escapeHTML(g)+'"></i>':g.length>35&&(m.innerHTML=g,g=(m.textContent||m.innerText||"").replace(/^(.{35}[^\s]*).*/,"$1")+"...",g=FLBuilderSettingsForms.escapeHTML(g)),"filter_meta_label"!=a||g||(g=FLBuilderSettingsForms.escapeHTML(o.filter_meta_key)),s&&(g='<img style="max-width: 60px" src="'+FLBuilderSettingsForms.escapeHTML(s)+'" />&nbsp;'+g),r.siblings(".fl-form-field-preview-text").html(g)),r.length>0&&!FLBuilder.isBlockEditor()&&(""!=(n=r.siblings("input").val().replace(/&#39;/g,"'"))&&(o=e.extend(FLBuilder._jsonParse(n),o)),r.siblings("input").val(JSON.stringify(o)).trigger("change")),!0)},_layoutFieldClicked:function(){var t=e(this);t.siblings().removeClass("fl-layout-field-option-selected"),t.addClass("fl-layout-field-option-selected"),t.siblings("input").val(t.attr("data-value"))},_initLinkFields:function(){e(".fl-builder-settings:visible .fl-link-field",window.parent.document).each(FLBuilder._initLinkField)},_initLinkField:function(){var t=e(this),l=t.find(".fl-link-field-search-input"),i=t.find(".fl-link-field-options-wrap input[type=checkbox]");l.autoSuggest(FLBuilder._ajaxUrl({fl_action:"fl_builder_autosuggest",fl_as_action:"fl_as_links",_wpnonce:FLBuilderConfig.ajaxNonce}),{asHtmlID:l.attr("name"),selectedItemProp:"name",searchObjProps:"name",minChars:3,keyDelay:1e3,fadeOut:!1,usePlaceholder:!0,emptyText:FLBuilderStrings.noResultsFound,showResultListWhenNoMatch:!0,queryParam:"fl_as_query",selectionLimit:1,afterSelectionAdd:FLBuilder._updateLinkField,formatList:function(e,t){return t.html(e.name+'<span class="type">['+e.type+"]</span>")}}),i.on("click",FLBuilder._linkFieldCheckboxClicked)},_updateLinkField:function(e,t,l){var i=e.closest(".fl-link-field"),o=i.find(".fl-link-field-search"),n=i.find(".fl-link-field-search-input");i.find(".fl-link-field-input").val(t.value).trigger("keyup"),n.autoSuggest("remove",t.value),o.hide()},_linkFieldSelectClicked:function(){var t=e(this).closest(".fl-link-field").find(".fl-link-field-search");t.show(),t.find("input").focus()},_linkFieldSelectCancelClicked:function(){var t=e(this);t.parent().hide(),t.closest(".fl-link-field").find("input.fl-link-field-input").focus()},_linkFieldCheckboxClicked:function(){var t=e(this),l=t.is(":checked"),i=t.siblings("input[type=hidden]"),o="";o=t.hasClass("fl-link-field-target-cb")?l?"_blank":"_self":l?"yes":"no",i.val(o)},_initFontFields:function(){e(".fl-builder-settings:visible .fl-font-field",window.parent.document).each(FLBuilder._initFontField)},_initFontField:function(){var t=e(this),l=t.closest(".fl-compound-field-section"),i=t.attr("data-value"),o=t.find(".fl-font-field-font"),n=t.find(".fl-font-field-weight");if(l.length&&!l.hasClass("fl-font-field-lazy-init"))return l.addClass("fl-font-field-lazy-init"),l.one("click",()=>FLBuilder._initFontField.apply(this)),void(i.indexOf("family")>-1&&(i=FLBuilder._jsonParse(i),o.append('<option value="'+i.family+'" selected>'+i.family+"</option>"),n.append('<option value="'+i.weight+'" selected>'+i.weight+"</option>")));if(FLBuilder._initFontFamilyOptions(o),FLBuilderConfig.select2Enabled&&o.select2({width:"100%"}).on("select2:open",function(t){e(".select2-search__field").attr("placeholder",FLBuilderStrings.placeholderSelect2)}),e("body",window.parent.document).on({mouseenter:function(){var t=jQuery(this).text(),l=jQuery(this).parent().parent().attr("aria-label"),i=jQuery("head",window.parent.document),o="https://fonts.googleapis.com/css?family="+t,n=t.toLowerCase().replaceAll(" ","-"),d=e(this).parent().parent().parent().attr("id");if(!d)return!1;if(d.indexOf("typographyfont_family")<0)return!1;if("Google"===l){if(linkElement="<link id='"+n+"' rel='stylesheet' href='"+o+"' type='text/css' media='screen'>",jQuery(this).css("font-family",'"'+t+'"'),jQuery("#"+n).length>0)return!1;i.append(linkElement)}}},".select2-results__option.select2-results__option--highlighted"),o.on("change",function(){FLBuilder._getFontWeights(o)}),i.indexOf("family")>-1){i=FLBuilder._jsonParse(i);var d=!1;fonts=FLBuilderFontFamilies,Object.keys(fonts.system).forEach(function(e){e===i.family&&(d=!0)}),Object.keys(fonts.google).forEach(function(e){e===i.family&&(d=!0)}),d||"Default"===i.family||(i={family:"Default",weight:"400"}),o.val(i.family),"Default"===i.family?FLBuilder._getFontWeights(o):o.trigger("change"),n.find("option[value="+i.weight+"]").length&&n.val(i.weight)}},_initFontFamilyOptions:function(e){if(!FLBuilder._fontFamilyCache){const e=FLBuilderFontFamilies,t=FLBuilderConfig.recentFonts||{},l=(e,t)=>{const l=document.createElement("option");return l.value=e,l.textContent=t,l},i=document.createDocumentFragment();i.appendChild(l("Default","Default"));const o=Object.keys(t).filter(e=>"Default"!==e);if(o.length){const e=document.createElement("optgroup");e.label="Recently Used",e.className="recent-fonts",o.forEach(t=>e.appendChild(l(t,t))),i.appendChild(e)}const n=document.createElement("optgroup");n.label="System",Object.keys(e.system).forEach(e=>{n.appendChild(l(e,e))}),i.appendChild(n);const d=document.createElement("optgroup");d.label="Google",Object.keys(e.google).forEach(e=>{d.appendChild(l(e,e))}),i.appendChild(d),FLBuilder._fontFamilyCache=i}e.empty(),e.append(FLBuilder._fontFamilyCache.cloneNode(!0))},_getFontWeights:function(t){var l=t.closest(".fl-font-field").find(".fl-font-field-weight"),i=t.val(),o=l.val(),n=FLBuilderConfig.FontWeights,d={},r=t.closest(".fl-font-field").find(".recent-fonts option");(l.html(""),r.length>0)&&(!1===e(r).filter(function(e,t){return t.value===i}).length>0&&"Default"!==i&&t.closest(".fl-font-field").find(".recent-fonts").append(e("<option>",{value:i,text:i})));d=void 0!==FLBuilderFontFamilies.system[i]?FLBuilderFontFamilies.system[i].weights:void 0!==FLBuilderFontFamilies.google[i]?FLBuilderFontFamilies.google[i]:FLBuilderFontFamilies.default[i],e.each(d,function(e,t){var i=o===t?" selected":"";l.append('<option value="'+t+'"'+i+">"+n[t]+"</option>")})},_initTinyMCE:function(){"object"==typeof tinymce&&void 0!==tinymce.ui.FloatPanel&&(tinymce.ui.FloatPanel.zIndex=100100),e(".fl-builder-hidden-editor",window.parent.document).each(function(){FLBuilder._initEditorField.call(this,window.parent)}),void 0!==FLBuilder.UIIFrame&&FLBuilder.UIIFrame.isEnabled()&&e(".fl-builder-hidden-editor").each(function(){FLBuilder._initEditorField.call(this,window)}),void 0!==window.parent.acf&&window.parent.acf.add_filter("wysiwyg_tinymce_settings",function(t,l){return e.extend({},tinyMCEPreInit.mceInit.flbuildereditor,t)})},_initEditorFields:function(){e(".fl-builder-settings:visible .fl-editor-field",window.parent.document).each(function(){FLBuilder._initEditorField.call(this,window.parent)})},_initEditorField:function(t){var l=e(this),i=l.find("textarea"),o=l.attr("data-name"),n="flrich"+(new Date).getTime()+"_"+o,d=FLBuilderConfig.wp_editor,r=t.tinyMCEPreInit,a=Number(l.attr("data-buttons")),s=l.attr("data-rows"),u=null,c=null;d=d.replace(/flbuildereditor/g,n),r=JSONfn.parse(JSONfn.stringify(r).replace(/flbuildereditor/g,n)),i.after(d).remove(),e("textarea#"+n,t.document).val(i.val()),void 0!==typeof t.tinymce&&void 0!==r.mceInit[n]&&((u=r.mceInit[n]).setup=function(e){e.on("SaveContent",function(e){e.content=e.content.replace(/<a href="(\.\.\/){1,2}/g,'<a href="'+FLBuilderConfig.homeUrl+"/"),e.content=e.content.replace(/src="(\.\.\/){1,2}/g,'src="'+FLBuilderConfig.homeUrl+"/")})},(c=e("#wp-"+n+"-wrap",t.document)).find("textarea").attr("rows",s),c.find("textarea").attr("contentEditable",!0),a||c.find(".wp-media-buttons").remove(),!c.hasClass("tmce-active")&&r.qtInit.hasOwnProperty(n)||u.wp_skip_init||t.tinymce.init(u)),void 0!==typeof t.quicktags&&t.quicktags(r.qtInit[n]),t.wpActiveEditor=n},_reinitEditorFields:function(){e("form.fl-builder-settings:visible",window.parent.document).length&&setTimeout(function(){var t,l;if(void 0!==window.parent.tinymce){for(t=window.parent.tinymce.editors.length-1;t>-1;t--)window.parent.tinymce.editors[t].inline||(l=window.parent.tinymce.editors[t].id,window.parent.tinyMCE.execCommand("mceRemoveEditor",!0,l),window.parent.tinyMCE.execCommand("mceAddEditor",!0,l));if(FLBuilder.preview){var i=e('.fl-field[data-type="editor"]',window.parent.document);FLBuilder.preview._initDefaultFieldPreviews(i)}}},1)},_destroyEditorFields:function(){var t;if(void 0!==window.parent.tinymce){for(t=window.parent.tinymce.editors.length-1;t>-1;t--)window.parent.tinymce.editors[t].inline||window.parent.tinyMCE.execCommand("mceRemoveEditor",!0,window.parent.tinymce.editors[t].id);e(".wplink-autocomplete",window.parent.document).remove(),e(".ui-helper-hidden-accessible",window.parent.document).remove()}},_updateEditorFields:function(){e(".fl-builder-settings:visible textarea.wp-editor-area",window.parent.document).each(FLBuilder._updateEditorField)},_updateEditorField:function(){var t=e(this),l=t.closest(".fl-editor-field"),i=(t.closest(".fl-builder-settings"),t.closest(".wp-editor-wrap")),o=t.attr("id"),n=l.attr("data-name"),d=void 0!==window.parent.tinymce&&window.parent.tinymce.get(o),r=t.siblings('textarea[name="'+n+'"]'),a=l.data("wpautop");0===r.length&&(r=e('<textarea name="'+n+'"></textarea>',window.parent.document).hide(),t.after(r)),a?d&&i.hasClass("tmce-active")?r.val(d.getContent()):void 0!==window.parent.switchEditors?r.val(window.parent.switchEditors.wpautop(t.val())):r.val(t.val()):(d&&i.hasClass("tmce-active")&&d.save(),r.val(t.val()))},_initPostTypeFields:function(){e(".fl-builder-settings:visible #fl-field-post_type").each(FLBuilder._initPostTypeField)},_initPostTypeField:function(){var t=e(this).find("select");FLBuilderConfig.select2Enabled&&t.select2({width:"50%"})},_loopDataSourceChange:function(){var t=e(this).val();e(".fl-loop-data-source",window.parent.document).hide(),e('.fl-loop-data-source[data-source="'+t+'"]',window.parent.document).show()},_customQueryPostTypesChange:function(){var t=e(this).val();for(val of(e(".fl-custom-query-filter").hide(),t))e(".fl-custom-query-"+val+"-filter").show()},_customQueryPostTypeChange:function(){var t=e(this).val();e(".fl-custom-query-filter",window.parent.document).hide(),e(".fl-custom-query-"+t+"-filter",window.parent.document).show()},_initOrderingFields:function(){e(".fl-builder-settings:visible .fl-ordering-field-options",window.parent.document).each(FLBuilder._initOrderingField)},_initOrderingField:function(){e(this).sortable({items:".fl-ordering-field-option",containment:"parent",tolerance:"pointer",stop:FLBuilder._updateOrderingField})},_updateOrderingField:function(t){var l=e(t.target),i=l.siblings("input[type=hidden]"),o=[];l.find(".fl-ordering-field-option").each(function(){o.push(e(this).attr("data-key"))}),i.val(JSON.stringify(o)).trigger("change")},_textFieldAddValueSelectChange:function(){var t=e(this),l=e('input[name="'+t.data("target")+'"]',window.parent.document),i=l.val(),o=t.val(),n="";-1==i.indexOf(o)&&(n=(i.trim()+" "+o.trim()).trim(),l.val(n).trigger("change").trigger("keyup")),t.val("")},_onNumberFieldFocus:function(t){var l=e(t.currentTarget);l.addClass("mousetrap"),Mousetrap.bind("up",function(){l.attr("step",1)}),Mousetrap.bind("down",function(){l.attr("step",1)}),Mousetrap.bind("shift+up",function(){l.attr("step",10)}),Mousetrap.bind("shift+down",function(){l.attr("step",10)})},_onNumberFieldBlur:function(t){e(t.currentTarget).attr("step","any").removeClass("mousetrap")},_initTimezoneFields:function(){e(".fl-builder-settings:visible .fl-field[data-type=timezone]",window.parent.document).each(FLBuilder._initTimezoneField)},_initTimezoneField:function(){var t=e(this).find("select"),l=t.attr("data-value");t.find('option[value="'+l+'"]').prop("selected",!0)},_initDimensionFields:function(){var t=e(".fl-builder-settings:visible",window.parent.document);t.find(".fl-field[data-type=dimension]").each(FLBuilder._initDimensionField),t.find(".fl-dimension-field-link").on("click",FLBuilder._dimensionFieldLinkClicked),FLBuilder.addHook("responsive-editing-switched",this._initResponsiveDimensionFieldLinking),t.find(".fl-compound-field-setting").has(".fl-dimension-field-link").each(FLBuilder._initDimensionFieldLinking)},_initDimensionField:function(){var t=e(this),l=t.find(".fl-field-label label"),i=t.find(".fl-field-control-wrapper"),o='<i class="fl-dimension-field-link fl-tip dashicons dashicons-admin-links" title="Link Values"></i>';l.append(o),i.prepend(o),FLBuilder._initTipTips(),FLBuilder._initDimensionFieldLinking.apply(this)},_initDimensionFieldLinking:function(){var t=e(this),l=t.find(".fl-dimension-field-link"),i=FLBuilder._getDimensionFieldLinkingInputs(t);FLBuilder._dimensionFieldInputsAreEqual(i)?(l.removeClass("dashicons-admin-links"),l.addClass("dashicons-editor-unlink"),i.off("input",FLBuilder._dimensionFieldLinkedValueChange),i.on("input",FLBuilder._dimensionFieldLinkedValueChange)):(l.addClass("dashicons-admin-links"),l.removeClass("dashicons-editor-unlink"))},_initResponsiveDimensionFieldLinking:function(){e(".fl-builder-settings:visible",window.parent.document).find(".fl-field[data-type=dimension]").each(FLBuilder._initDimensionFieldLinking)},_dimensionFieldLinkClicked:function(){var t=e(this),l=t.closest(".fl-compound-field-setting"),i=l.length?l:t.closest(".fl-field"),o=i.find(".fl-dimension-field-link"),n=o.hasClass("dashicons-editor-unlink"),d=FLBuilder._getDimensionFieldLinkingInputs(i);o.toggleClass("dashicons-admin-links"),o.toggleClass("dashicons-editor-unlink"),n?d.off("input",FLBuilder._dimensionFieldLinkedValueChange):(d.val(d.eq(0).val()).trigger("input"),d.on("input",FLBuilder._dimensionFieldLinkedValueChange))},_dimensionFieldLinkedValueChange:function(){var t=e(this),l=t.attr("name"),i=t.closest(".fl-dimension-field-units").find('input:not([name="'+l+'"])');i.off("input",FLBuilder._dimensionFieldLinkedValueChange),i.val(t.val()).trigger("input"),i.on("input",FLBuilder._dimensionFieldLinkedValueChange)},_getDimensionFieldLinkingInputs:function(e){var t=!!e.find(".fl-field-responsive-setting").length,l=FLBuilderResponsiveEditing._mode;return t?e.find(".fl-field-responsive-setting-"+l+" input"):e.find(".fl-dimension-field-unit input")},_dimensionFieldInputsAreEqual:function(e){var t=e.eq(0).val();if(""===t)return!1;for(var l=1;l<4;l++)if(e.eq(l).val()!==t)return!1;return!0},_initFieldPopupSliders:function(){e(".fl-builder-settings:visible",window.parent.document).find(".fl-field-popup-slider").each(FLBuilder._initFieldPopupSlider)},_initFieldPopupSlider:function(){var t=e("body",window.parent.document),l=e(this),i=l.find(".fl-field-popup-slider-input"),o=l.find(".fl-field-popup-slider-arrow"),n=l.data("input"),d=e('input[name="'+n+'"]',window.parent.document);d.on("click",function(){i.hasClass("fl-field-popup-slider-init")||(i.slider({value:d.val(),slide:function(e,t){d.val(t.value).trigger("input")}}),d.on("input",function(){i.slider("value",e(this).val())}),i.addClass("fl-field-popup-slider-init"),i.find(".ui-slider-handle").removeAttr("tabindex")),FLBuilder._setFieldPopupSliderMinMax(i),FLBuilder._hideFieldPopupSliders(),t.on("mousedown",FLBuilder._hideFieldPopupSliders),d.addClass("fl-field-popup-slider-focus"),l.show();var n=e(".fl-builder-settings:visible .fl-builder-settings-tab.fl-active",window.parent.document),r=n.offset(),a=d.offset(),s=d.width(),u=l.offset();u.top+l.outerHeight()>r.top+n.outerHeight()&&l.addClass("fl-field-popup-slider-top"),o.css("left",2+a.left-u.left+s/2+"px")}),d.on("focus",function(){FLBuilder._hideFieldPopupSliders()})},_hideFieldPopupSliders:function(t){var l=t?e(t.target):null,i=e("body",window.parent.document),o=e(".fl-field-popup-slider:visible",window.parent.document),n=e(".fl-field-popup-slider-focus",window.parent.document);if(l){if(l.closest(".fl-field-popup-slider").length)return;if(l.closest(".fl-field-popup-slider-focus").length)return}i.off("mousedown",FLBuilder._hideFieldPopupSliders),n.removeClass("fl-field-popup-slider-focus"),o.hide()},_setFieldPopupSliderMinMax:function(e){var t=e.parent(),l=t.parent().parent().find("select.fl-field-unit-select"),i=l.val(),o=t.data("slider"),n=0,d=100,r=1;""!==i&&"em"!==i&&"rem"!==i||(d=10,r=.1),"object"==typeof o&&(n=o.min?parseFloat(o.min):n,d=o.max?parseFloat(o.max):d,r=o.step?parseFloat(o.step):r,l.length&&o[i]&&(n=o[i].min?parseFloat(o[i].min):n,d=o[i].max?parseFloat(o[i].max):d,r=o[i].step?parseFloat(o[i].step):r)),e.slider({min:n,max:d,step:r})},_initPresetFields:function(){e(".fl-builder-settings:visible",window.parent.document).find(".fl-preset-select-controls").each(FLBuilder._initPresetField)},_initPresetField:function(){var t=e(this),l=t.find("select"),i=t.data("presets"),o=t.data("prefix");l.on("change",FLBuilder._setFormPreset.bind(this,i,o))},_setFormPreset:function(t,l,i){var o=e(i.currentTarget).val();if(presetLists=FLBuilderConfig.presets,presets=presetLists[t],form=e(".fl-builder-settings:visible",window.parent.document),"undefined"!==presets&&"undefined"!==presets[o]){var n=presets[o].settings;for(var d in n){o=n[d];(void 0!==l&&""!==l?form.find('[name="'+l+d+'"]'):form.find('[name="'+d+'"]')).val(o).trigger("change").trigger("input")}}},ajax:function(t,l){var i;if(!FLBuilder._ajaxRequest){for(i in FLBuilder.triggerHook("didBeginAJAX",t),t)void 0===t[i]&&(t[i]=null);return t._wpnonce=FLBuilderConfig.ajaxNonce,t.post_id=FLBuilderConfig.postId,t.fl_builder=1,t.safemode=FLBuilderConfig.safemode,t.fl_action=t.action,void 0!==t.settings&&(t.settings=FLBuilder._ajaxModSecFix(e.extend(!0,{},t.settings)),t.settings=FLBuilder._inputVarsCheck(t.settings)),void 0!==t.node_settings&&(t.node_settings=FLBuilder._ajaxModSecFix(e.extend(!0,{},t.node_settings)),t.node_settings=FLBuilder._inputVarsCheck(t.node_settings)),void 0!==t.node_preview&&(t.node_preview=FLBuilder._ajaxModSecFix(e.extend(!0,{},t.node_preview)),t.node_preview=FLBuilder._inputVarsCheck(t.node_preview)),"error"===t.settings||"error"===t.node_settings||"error"===t.node_preview?0:(t={fl_builder_data:t},FLBuilder._ajaxRequest=e.post(FLBuilder._ajaxUrl(),t,function(i){try{debugdata=e.parseJSON(i)||!1}catch(e){debugdata=i}debugdata&&void 0!==debugdata.mem_usage&&console.log("AJAX: "+debugdata.mem_usage),void 0!==l&&l.call(this,i),FLBuilder.triggerHook("didCompleteAJAX",t)}).always(FLBuilder._ajaxComplete).fail(function(e,t,l){switch(msg=!1,e.status){case 403:case 409:case 418:msg="Something you entered has triggered a "+e.status+" error.<br /><br />This is nearly always due to mod_security settings from your hosting provider.",window.crash_vars.white_label||(msg+='<br /><br />See this <a target="_blank" style="color: #428bca;font-size:inherit" href="https://docs.wpbeaverbuilder.com/beaver-builder/troubleshooting/common-issues/403-forbidden-or-blocked-error">Knowledge Base</a> article for more info.</br />')}msg&&(console.log(e),console.log(l),FLBuilder.alert(msg))}),FLBuilder._ajaxRequest)}FLBuilder._ajaxQueue.push({data:t,callback:l})},_inputVarsCheck:function(e){let t=FLBuilderConfig.MaxInputVars||0,l=FLBuilderConfig.debug||!1,i=(JSON.stringify(e).match(/[^\\]":/g)||{}).length;return void 0!==i&&(l&&console.log("Debug: Input Vars "+i+"/"+t),i>t)?(FLBuilder.alert('<h1 style="font-size:2em;text-align:center">Critical Issue</h1><br />The number of settings being saved ('+i+") exceeds the PHP Max Input Vars setting ("+t+").<br />Please contact your host to have this value increased, the default is 1000."),console.log("Vars Count: "+i),console.log("Max Input: "+t),"error"):e},_ajaxComplete:function(){if(FLBuilder._ajaxRequest=null,FLBuilder.hideAjaxLoader(),FLBuilder._ajaxQueue.length){var e=FLBuilder._ajaxQueue.shift();FLBuilder.ajax(e.data,e.callback)}},_ajaxUrl:function(e){var t=FLBuilderConfig.shortlink,l=null;if(void 0!==e)for(l in e)t+=t.indexOf("?")>-1?"&":"?",t+=l+"="+e[l];return t},showAjaxLoader:function(){0===e(".fl-builder-lightbox-loading",window.parent.document).length&&e(".fl-builder-loading",window.parent.document).show()},hideAjaxLoader:function(){e(".fl-builder-loading",window.parent.document).hide()},_showNodeLoading:function(t){var l=e(".fl-node-"+t);l.addClass("fl-builder-node-loading"),FLBuilder.triggerHook("didStartNodeLoading",l)},_hideNodeLoading:function(t){e(".fl-node-"+t).removeClass("fl-builder-node-loading")},_showNodeLoadingPlaceholder:function(t,l){var i=e('<div class="fl-builder-node-loading-placeholder"></div>');e(".fl-builder-node-loading-placeholder").remove(),t.hasClass("fl-builder-content")?siblings=t.find(" > .fl-row, > .fl-module"):t.hasClass("fl-row-content")?siblings=t.find(" > .fl-col-group, > .fl-module"):t.hasClass("fl-col-group")?(t.addClass("fl-col-group-has-child-loading"),siblings=t.find(" > .fl-col")):siblings=t.find(" > .fl-col-group, > .fl-module"),0===siblings.length||siblings.length==l?t.append(i):siblings.eq(l).before(i)},_removeNodeLoadingPlaceholder:function(e){var t=e.prev(".fl-builder-node-loading-placeholder"),l=e.next(".fl-builder-node-loading-placeholder");t.length?t.remove():l.remove()},_ajaxModSecFix:function(e){var t;if(FLBuilderConfig.modSecFix&&"undefined"!=typeof btoa)if("string"==typeof e)e=FLBuilder._btoa(e);else for(t in e)type=typeof e[t],"string"==type||"number"==type?e[t]=FLBuilder._btoa(e[t]):"object"==type&&(e[t]=FLBuilder._ajaxModSecFix(e[t]));return e},_btoa:function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},_wpmedia_reset_errors:function(){e(".upload-error",window.parent.document).remove(),e(".media-uploader-status",window.parent.document).removeClass("errors").hide()},_initLightboxes:function(){FLBuilder._lightbox=new FLLightbox({className:"fl-builder-lightbox fl-builder-settings-lightbox",resizable:!0}),FLBuilder._lightbox.on("resized",FLBuilder._calculateSettingsTabsOverflow),FLBuilder._lightbox.on("close",FLBuilder._lightboxClosed),FLBuilder._lightbox.on("beforeCloseLightbox",FLBuilder._destroyEditorFields),FLBuilder._actionsLightbox=new FLLightbox({className:"fl-builder-actions-lightbox"})},_showLightbox:function(e){e||(e='<div class="fl-builder-lightbox-loading"></div>'),FLBuilder._lightbox.open(e),FLBuilder._initLightboxScrollbars()},_setLightboxContent:function(e){FLBuilder._lightbox.setContent(e)},_initLightboxScrollbars:function(){FLBuilder._initScrollbars(),clearTimeout(FLBuilder._lightboxScrollbarTimeout),FLBuilder._lightboxScrollbarTimeout=setTimeout(FLBuilder._initLightboxScrollbars,500)},_lightboxClosed:function(){FL.Builder.data.getOutlinePanelActions().setActiveNode(!1),FLBuilder.triggerHook("settings-lightbox-closed"),FLBuilder._lightbox.empty(),clearTimeout(FLBuilder._lightboxScrollbarTimeout),FLBuilder._lightboxScrollbarTimeout=null},_showActionsLightbox:function(e){var t=wp.template("fl-actions-lightbox");FLBuilder.triggerHook("actions-lightbox-settings",e),FLBuilder._actionsLightbox.open(t(e))},_checkEnv:function(){"svg"===FLBuilderConfig.fontAwesome&&FLBuilder.alert(FLBuilderStrings.fontAwesome)},alert:function(e){var t=new FLLightbox({className:"fl-builder-alert-lightbox",destroyOnClose:!0}),l=wp.template("fl-alert-lightbox");t.open(l({message:e}))},crashMessage:function(e){FLLightbox.closeAll();var t=new FLLightbox({className:"fl-builder-alert-lightbox fl-builder-crash-lightbox",destroyOnClose:!0}),l=wp.template("fl-crash-lightbox"),i=window.crash_vars.product,o=window.crash_vars.white_label,n=window.crash_vars.labeled_txt,d="";message=i+" "+window.crash_vars.strings.intro,d+="<h3 style='font-size:26px;line-height:26px;'>"+window.crash_vars.strings.try+"</h3>",d+="<p>"+window.crash_vars.strings.troubleshoot+"</p>",d+="<h3 style='font-size:22px;line-height:22px;padding-top:20px;border-top:1px solid black;'>"+window.crash_vars.strings.hand+"</h3>",d+="<h3 style='font-size:18px;line-height:18px;'>"+window.crash_vars.strings.step_one+"</h3>",d+="<p>"+window.crash_vars.strings.if_contact+"</p>",d+="<div><div style='width:49%;float:left;'>",d+="<p>MacOS Users:<br />Chrome: View > Developer > JavaScript Console<br />Firefox: Tools > Web Developer > Browser Console<br />Safari: Develop > Show JavaScript console</p>",d+="</div>",d+="<div style='width:49%;float:right;'>",d+="<p>Windows Users:<br />Chrome: Settings > More Tools > Developer > Console<br />Firefox: Menu/Settings > Web Developer > Web Console<br />Edge: Settings and More > More Tools > Console</p>",d+="</div></div>",d+="<h3 style='font-size:18px;line-height:18px;display:inline-block'>"+window.crash_vars.strings.step_two+"</h3>",d+="<p style='display:inline-block;'>"+window.crash_vars.strings.contact+"</p>",FLBuilderConfig.MaxInputVars<=3e3&&(d+="<br /><br />The PHP config value max_input_vars is only set to "+FLBuilderConfig.MaxInputVars+'. If you are using 3rd party addons this could very likely be the cause of this error. [<a class="link" href="https://docs.wpbeaverbuilder.com/beaver-builder/troubleshooting/common-issues/exceeds-php-max-input-vars">doc link</a>].'),o&&(d=n),t.open(l({message:message,info:d,debug:false}))},_alertClose:function(){FLLightbox.closeParent(this)},confirm:function(t){var l={cssClass:"",message:"",ok:function(){},cancel:function(){},strings:{ok:FLBuilderStrings.ok,cancel:FLBuilderStrings.cancel}},i=e.extend({},l,void 0===t?{}:t);lightbox=new FLLightbox({className:"fl-builder-confirm-lightbox fl-builder-alert-lightbox"+i.cssClass,destroyOnClose:!0}),template=wp.template("fl-confirm-lightbox"),lightbox.open(template(i)),lightbox._node.find(".fl-builder-confirm-ok").on("click",i.ok),lightbox._node.find(".fl-builder-confirm-cancel").on("click",i.cancel)},log:function(e){void 0!==window.console&&void 0!==window.console.log&&console.log(e)},logError:function(t,l){var i=null;void 0!==t&&(void 0!==t.stack?i=t.stack:void 0!==t.message&&(i=t.message),i&&(FLBuilder.log("************************************************************************"),FLBuilder.log(FLBuilderStrings.errorMessage),FLBuilder.log(i),void 0!==l&&l&&(FLBuilder.log("Debug Info"),console.log(l)),e.each(window.crash_vars.vars,function(e,t){console.log(e+": "+t)}),FLBuilder.log("************************************************************************"),void 0!==l&&l&&(i=l+"\n"+i),FLBuilder.crashMessage(i)))},logGlobalError:function(e,t,l,i,o){FLBuilder.log("************************************************************************"),FLBuilder.log(FLBuilderStrings.errorMessage),FLBuilder.log(FLBuilderStrings.globalErrorMessage.replace("{message}",e).replace("{line}",l).replace("{file}",t)),void 0!==o&&void 0!==o.stack&&FLBuilder.log(o.stack),FLBuilder.log("************************************************************************")},_jsonParse:function(e){"string"!=typeof e&&(e=JSON.stringify(e));try{e=JSON.parse(e)}catch(t){if(e.indexOf("</b> on line ")>0||e.indexOf(" in <b>")>0)return type="Unknown",regex=new RegExp("<b>(Notice|Warning|Fatal error)</b>:(.*) in <b>","m"),error=regex.exec(e),FLBuilder.isUndefined(error[1])||(type=error[1]),FLBuilder.isUndefined(error[2])?error="Unknown PHP error":error=error[2],e.indexOf("Fatal error")>0?(regex=new RegExp("<b>Fatal error<\\/b>:\\s+Allowed\\smemory\\ssize of\\s([0-9]+)","gm"),m=regex.exec(e),FLBuilder.isUndefined(m[1])?(msg='<p style="font-weight:bold;text-align:center;"><strong>PHP '+type+" detected in AJAX response</strong></p>",msg+="<p>"+error+"</p>",msg+="<p>"+window.crash_vars.strings.fatal.footer+"</p>",FLLightbox.closeAll(),FLBuilder.alert(msg),!1):(ram=m[1]/1024/1024,msg='<p style="font-weight:bold;text-align:center;"><strong>PHP '+type+" detected in AJAX response</strong></p>",msg+="<p>"+window.crash_vars.strings.fatal.content.replace("[MEM]",ram)+"</p>",msg+="<p>"+window.crash_vars.strings.fatal.footer+"</p>",FLLightbox.closeAll(),FLBuilder.alert(msg),!1)):(msg='<p style="font-weight:bold;text-align:center;"><strong>PHP '+type+" detected in AJAX response</strong></p>",msg+="<p>"+error+"</p>",msg+="<p>"+window.crash_vars.strings.fatal.footer+"</p>",FLLightbox.closeAll(),FLBuilder.alert(msg),!1);FLBuilder.logError(t,FLBuilder._parseError(e))}return e},_parseError:function(t){if(t.indexOf("</head>"))return"AJAX returned HTML page instead of data. (Possible 404 or max_input_vars)";if(php=t.match(/^<.*/gm)||!1,php&&php.length>0){var l="";return e.each(php,function(e,t){l+=t}),e(l).text()}return!1},getSandbox:function(e){return e in this._sandbox&&this._sandbox[e]},setSandbox:function(e,t){this._sandbox[e]=t},deleteSandbox:function(e){delete this._sandbox[e]}},FLBuilder=new Proxy(FLBuilder,{deprecated:{isBlockEditor:FL.Builder.utils.isBlockEditor,isBoolean:FL.Builder.utils.isBoolean,isUndefined:FL.Builder.utils.isUndefined,addHook:FL.Builder.utils.hooks.add,removeHook:FL.Builder.utils.hooks.remove,triggerHook:FL.Builder.utils.hooks.trigger,_initColorScheme:FL.Builder.utils.colorScheme.init,_isSystemColorSchemeDark:FL.Builder.utils.colorScheme.isSystemDark,_getComputedColorScheme:FL.Builder.utils.colorScheme.getComputedColorScheme,_systemColorSchemeChanged:FL.Builder.utils.colorScheme.systemColorSchemeChanged,_setColorSchemeBodyClasses:FL.Builder.utils.colorScheme.setBodyClasses,_focusFirstSettingsControl:FL.Builder.settingsForms.focusFirstSettingsControl},get(e,t,l){return t in this.deprecated?this.deprecated[t]:Reflect.get(...arguments)}}),e(function(){FLBuilder._init()})}(jQuery);